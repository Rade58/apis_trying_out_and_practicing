# KREIRANJE API Endpoint-A

BILO BI COOL, DA KREIRAM API Endpoint, KOJI CE MI OMOGUCITI DA GETT-UJEM ALL THE POSTS

## TO BI UKLJUCIVAL OSLEDECE STVARI

DAKLE TO BI BIO HTTP REGUEST GDE BI SE MORALO URADITI SLEDECE

- HOOK-OVATI SE U FIRESTORE; GETTOVATI ALL THE POSTS

- POSLATI IH NAZAD KAO JSON

*TO ZVUCI KAO DOBAR FIRST ATTEMPT U OVOM SLUCAJU*

## DAKLE, KREIRAM NOVI NAMED EXPORT U functions/index.js FAJLU;  I TO CE BITI NOVA CLOUD FUNKCIJA, KOJU CU NAZVATI getAllPosts

```javascript
const functions = require('firebase-functions');
// POTREBAN MI JE admin
const admin = require('firebase-admin');

// firebase-admin JE VERZIJA firebase-A, KOAJ IMA SVE 'SUPER POWERS', THAT THE ADMIN CONSOLE HAS 
// (OVO JE OPET BACKEND TERMIN ZA KOJI PREDPOSTAVLJAM STA JE ALI NISAM RADIO BACKEND U KLASICNOM SMISLU
// MISLIM NA TERMIN 'ADMIN CONSOLE')
// KAKO KINNEY KAZE

// KINNEY KAZE DA CAK NE MORA MKORISTITI NI CLOUD FUNCTIONS, VEC DA MOGU KORISITI firebase-admin KAO SCRIPT KOJI
// RUNN-UJEM FROM THE COMPUTER ("OH I NEED TO CHANGE BUNCH OF DATA, MAYBE HOW COMMENTS ARE FORMATED")

// TADA BIH KORISTIO SECRET KEY PAIRS (NISAM SIGURAN DA LI ON GOVORI O VAPID KLJUCEVIMA, KOJE SAM KORISTIO
// ALI MISLIM DA SAM NJIH KORISTIO SAMO U JEDNOM PROJEKTU KAKO BIH DEFINISAO SUBSCRIBING NA NOTIFICATIONS)
// MOZDA NE MISLI NA TO (NE, ON NIJE MISLIO NA TO)

// NA PRIMER TI KLJUCEVI JESU POTREBNI ZA AWS LAMBDA, ILI KADA BIH KAO SO SAM REKAO, STVARI RADIO LOKLNO N MOJOJ 
// MASINI; ALI OVDE POSTO JE REC O GOOGLE CLOUD SERVISU (ODNOSNO DEFINISEM CODE ZA NJIHOVE SERVERE), TO JE URADJENO 
// ZA MENE; GLEDAJ OVO

admin.initializeApp(functions.config().firebase);

// SECRETE KEY SE DOBIJA, KADA E POZOVE GORNJE config()
// ON CE BITI PASSED IN BY ENVIROMENT, KADA JE REC O RUNNING-U NA GOOGLE SERVERIMA
// AKO POMENUTO RUNN-UJEM NA MOM SOPSTVENOM COMPUTER-U, NECU DOBITI
// ANYTHING BACK FROM

// ALI KADA SE RUNN-UJE NA GOOGLE SERVERIMA, TO CE BITI POPULATED SA MOJIM:     SECRET KEY PAIR-OM

// adimn KORISTIM I DA BIH IMAO PRISTUP FIRESTORE-U

const firestore = admin.firestore();

// SLEDECA STVAR, AKO SE DOBRO SECAM OD RANIJE JE VEC SETTED UP PO DFAULT-U, ALI HAJDE DA JE DEFINISEM
// UGLAVNOM AKO NIJE PODESENO, TREBAO BI DA DOBIJAM Warning U KONZOLI (U BROWSER-U, PRI FETCHING-U)
firestore.settings({timestampsInSnapshots: true});


// *************ne obracaj paznju na ovo*********************************
// // Create and Deploy Your First Cloud Functions
// // https://firebase.google.com/docs/functions/write-firebase-functions
//
exports.helloWorld = functions.https.onRequest((request, response) => {
 response.send("Hello from Firebase!");
});
//***********************************************************************

// EVO OVDE DEFINISEM NOVI CLOUD FUNCTION

// FUNKCIJA MOZE BITI async JER JE REC O Node.Js VERZIJI 8, KAO STO SAM I REKAO

exports.getAllPosts = functions.https.onRequest((request, response) => {

    // KINNEY KAZE DA JE RANIJE GRESIO, PRI KORISCENJU EXPRESS-A (PREDPSOTAVLJAM DA JE OVO Express.Js LIBRARY
    //                                                              Node.JS, KOJI JA EVO KORISTIM BEZ FORMALNOG
    //                                                              UPOZNAVANJA)

    // GRESIO JE TAKO STO JE SLUCAJNO PROMENIO MESTO GORNJIM PARAMETRIMA FUNKCIJE (request UVEK IDE PRVI)
    // JASNO JE KAKO SE MOZE DESITI OGROMANA GRESKA KADA SE IZGUBI IZ VIDA DA JE Request INSTANCA UVEK PRVI
    // ARGUMENT PRI POZIVANJU OVE FUNKCIJE

    // !!!!!!!!!!!!!!!!!!!!!  SADA OPET MALO PODSECANJE NA FIRESTORE API

                        // non-ASYNC deo

    // doc          METODA RETURN-UJE       DocumentReference       INSTANCU
    // collection   METODA RETURN-UJE       CollectionReference     INSTANCU
    // KAO STO REKOH, ONE NISU ASINHRONE METODE
            

                        // ASYNC   deo

    //      OBE GORNJE INSTANCE IMAJU METODU      get (NJEMU SE DODAJE ARGUMENT I ON GETT-UJE JEDAN FIELD)
                                                // data()  CEO OBJEKAT
    // 

    const queryDocSnapshot = await firestore.collection('posts')get()

    // POSTO JE QueryDocumentSnapshot USTVARI NIZ

});


```
