# DAKLE REKAO SAM DA CU OVDE OBJASNITI, KAKO DA I ONU FUNKCIONALNOST, KOJA JE U Application KOMPONENTI, A KOJA SE ODNOSI NA DEO FUNKCIONALNOSTI FIREBASE-A, KOJI RUKUJE SA user-OM U MOM APP-U ,USTVARI PREMESTIM U SOPSTVENU KOMPONENTU, KOJA CE KORISTITI SAMO CONTEXT, ODNOSNO PROVIDER-A; A KASNIJE CU OPET KORISTITI HOOKS, KAKO BI SE HOOK-OVAO NA CONTEXT (DAKLE NECU KORISITI CONSUMER-A, VEC HOOKS)

ZA SADA IMAM OVAKVU SITUACIJU U Application KOMPONENTI

```javascript
import React, {Component} from 'react';
import Posts from './Posts';

import Authentication from './Authentication';

import {auth , createUserProfileDocument} from '../firebase';    // OVO VISE NECE TREBATI
                                                                // JER NECU KORISITI VISE FIREBASE
                                                                // U Application KOMPONENTI

class Application extends Component {

    state = {user: null}    // KADA UKLONIM OVO
                            // CELU KOMPONENTU MOGU REDEFINISATI, DA BUDE FUNCTIONAL KOMPONNTA

    unsubscribeFromAuth = null;   // I OVO CE BITI UKLONJENO

    componentDidMount = async () => {

        this.unsubscribeFromAuth = auth.onAuthStateChanged(userAuth => {            // KADA UKLONIM
                                                                            // OVO NEMA STA DA BUDE U
            createUserProfileDocument(userAuth)                             // componentDidMount
            .then(data => {                                                 // TAKO DA VISE NI ONA NECE TREBATI

                console.log("user OBJEKAT JE UNUTRA: ", {user: data})

                this.setState({user: data})
            })


        })

    }

    render(){

        const {user} = this.state;    //  user VISE NECE TREBATI, JER GA NECE BITI U STATE-U OVE KOMPONENTE

        // USER OBJEKAT CE USTVARI BITI HOOKOVAN, ODNOSNO HOOKED OUT UZ POMOC useContext
        // I PROSLEDJEN REACT ELEMENTU, REPRESENTED BY Authentication COMPONENT

        return (
            <main className="application">
                <h1>Think Clone</h1>
                <Authentication user={user} />
                <Posts/>
            </main>
        )
    }

}

export default Application;
```

## SVE GORE STO SAM REKAO DA CU IZBACITI, TREBA DA BUDE DEO NOVE KOMPONENTE, KOJU CU KREIRATI, A KOJA CE BITI DODATA U providers FOLDER, A TA KOMPONENTA CE SE ZVATI UserProvider

src/providers/UserProvider.jsx

```javascript
// UVOZIM STA MI JE POTREBNO, UKLJUCUJUCI CONTEXT, KAO I SVE VEZANO ZA auth

import React, {Component, createContext} from 'react';

import {auth, createUserProfileDocument} from '../firebase';

// KREIRAM CONTEXT, KOJI I IZVOZIM

export const UserContext = createContext();

// KREIRAM KOMPONENTU

class UserProvider extends Component {

    // DEFINISEM STATE, KOJI CE IMATI SAMO user PROPERTI
    // INITALLY BICE null, A KAO STO ZNAM, KADA SE
    // PROCITA USER OD autha, I KADA SE DODA NOVI DOKUMENT
    // KOJI REPREZENTUJE USER-A, I KADA SE ISTI PROCITA
    // TADA CE TAJ PROPERTI STATE BITI NAHRANJEN TIM USER PODACIMA
    // IS ODGOVARJUCEG DOKUMENTA users KOLEKCIJE

    state = {user: null}

    // DEFINISEM I PROPERTI, KOJI TREBA DA SKLADISTI UNSUBSCRIBE FUNKCIJU

    unsubscribeFromAuth = null;

    // DEFINISEM componentDidMount
    // U KOJO SE OBAVLJAJU SVE RADNJE SLUSANJA AUTH STATE CHANGE-A U FIREBASE-U
    // A VEC SAM OBJASNIO STA SE SVE RADI SA AUTHENTICATION-OM
    // I KAK OSE KREIRA NOVI DOKUMENT U users KOLEKCIJ CLOUD FIRESTORE-A
    // TAKO DA TO NECU DODATNO OBJASNJAVATI

    // UGLAVNOM KORISTIM ONU FUNKCIJU KOJU SAM KREIRAO U firebase.js FAJLU
    // A TA FUNKCIJA USTVARI KREIRA NOVI USER DOKUMENT U FIRESTORU, I ODMAH
    // GA FETCHUJE NAZAD (TO JE ONO STO SE PITAM DA LI SE NAZIVA "OPTIMISTIC UPDATE")

    componentDidMount = () => {

        this.unsubscribeFromAuth = auth.onAuthStateChanged(async userAuth => {

            const user = await createUserProfileDocument(userAuth);

            this.setState({user})

        })

    }

    // KREIRA Mrender METODU

    render(){

        // RETRUKTURIRANJE PROPSA, KAKO BI PRISTUPIO children-IMA
        // I RESTRUKTURIRANJE STATE-A, KAKO BI PRISTUPIO user-U

        const {children} = this.props;
        const {user} = this.state;

        // KREIRAM PROVIDER-A, U KOJEG NEST-UJEM CHILDREN
        // A KAO value, KOJA TREBA DA SE PROSLEDJUJE, JESTE user OBJEKAT

        return (
            <UserContext.Provider value={user}>
                {children}
            </UserContext.Provider>
        );

    }


}

// SADA DA IZVEZEM, OVU KOMPONENTU

export default UserProvider;
```

POSTO SAM TO URADIO, MOGU ODMAH U Application KOMPONENTU DA JE REFAKTORISEM I DA ISKORISTIM HOOKS, KAKO BI SE HOOK-OVAO IN UserContext I PULL-OVAO OUT DATA

MEDJUTIM PRE TOGA MORAM UPOTREBITI OVOG PROVIDER-A

## NESTOVANJE JEDNOG PROVIDER-A U DRUGI, JESTE POTPUNO VALIDNA SINTAKSA JSX-A

JA CU UPRAVO TAKVU SITUACIJU U ENTRY POINT FAJLU

src/index.js FAJL

```javascript
import React from 'react';
import {render} from 'react-dom';

import PostsProvider from './providers/PostsProvider';

// UVESCU OVDE userProvider KOMPONENTU
import UserProvider from './providers/UserProvider'

import './index.css';

import Application from './components/Application';


// MOGU SAV DONJI JSX ARGUMENT, OD RANIJE, DA WRAPP-UJEM U NOVOG PROVIDER-A

render(
    <UserProvider>
        <PostsProvider>
            <Application/>
        </PostsProvider>
    </UserProvider>,
    document.getElementById('root')
);
```

KAO STO VIDIS IMAS DVA PROVIDERA ,NESTED JEDAN U DRUGI, I NESTED REACT ELEMENT, REPRESENTED BY Application COMPONENT

## CISTO DA NAPOMENEM DA POSTO KORISTIM HOOKS, JA NECU KORISTITI CONSUMER-A, A DA SAM KORISTIO CONSUMERA, JA BIH IMAO JEDNOG CONSUMER-A, NESTED U DRUGOM; ODNOSNO JEDNOG CONSUMER-A NESTED U CALLBACK-U DRUGOG

DA NE SIRIM PRICU, U [ZVAICNOM TUTORJALU](https://reactjs.org/docs/context.html#consuming-multiple-contexts) SVE JE DIVNO PRIKAZAN

## POSTO SAM SE ODLUCIO DA KORISTIM HOOKS, DA KONACNO PRIKAZEM KAKO Application KOMPONENTU TRASFORMISEM IZ CLASS COMPONENT U FUNCTIONAL COMPONENT, I KAKO KORISTIM HOOKS DA SE HOOK-UJEM U POMENUTI, NOVOKREIRANI CONTEXT, I PULL-UJEM DATA O USER-U

src/components/Aplication.jsx FAJL:

```javascript
// ZA RAZLIKU OD RANIJE, VISE MIO NE TREBA Component KLASA
// DAKLE BICE UVEZENO SAMO React
// ALI JE TAKODJE POTREBNO DA UVEZEM        useContext      FUNKCIJU, IZ 'react'
// ODNOSNO UVOZIM HOOK
import React, {useContext} from 'react';

import Posts from './Posts';
import Authentication from './Authentication';

// UKLONIO SAM SVE UVOZE VEZANE ZA auth
// A SADA UVOZIM CONTEXT KOJI SAM KORISTIO ZA USER DATA
import {UserContext} from '../providers/UserProvider';

// DAKLE Application CE SADA BITI FUNCTIONAL COMPONENT

const Application = () => {

    // ODMAH DA PULL-UJEM DATA IZ CONTEXT-A, UZ POMOC HOOK-A

    const user = useContext(UserContext);

    // SADA MOGU DA RETURN-UJEM OVU KOMPONENTU SA JSX-OM
    // A USER SE PROSLEDJUJE, KAO PROP, REACT ELEMENTU, REPRESENTED BY
    //Authentication COMPONENT

    return (
        <main className="application">
            <h1>Think Clone</h1>
            <Authentication user={user}/>
            <Posts/>
        </main>
    );

}

export default Application;

```
