# React Context API

OVO MI NIJE PRVI PUT DA GA KORISTIM, ALI ZELI MDA VIDIM KAKO GA KINNEY KORISTI U OVOM APP-U

## MISLIM DA CU PRVO KRENUTI OD posts

NAIME ZELIMDA DA TAJ PROPERTI STATE-A, PRVO PULL-UJEM U Context API

I JEDINA PODKOMPONENTA Applicatio nKOMPONENTA, KOJ UZANIMA posts, JESTE UPRAVO Posts KOMPONENTA

TO ASE NARAVNO MOZE PROMENITI, DOK MOJA APLIKACIJA RASTE

## NE IZGLEDA KAO DOBRA PRAKSA DA ONO STO SE TICE CONTEXT-A DODAJEM U src/components; ZATO CU KREIRATI JEDAN NOVI FOLDER U src FOLDERU; A TAJ NOVI FOLDER CE SE ZVATI providers

PRVI FAJL KOJI CU TAMO KREIRATI BICE **PostsProvider.jsx**

U POMENUTOM FAJLU CU KREIRATI KOMPONENTU, KOJA KEEPUJE SVE posts IZ STATE-A I KOJA IH ONDA MOZE DATI CHILD KOMPONENTAMA

DAKLE JA WRAPP-UJEM BILO KOJU KOMPONENTU U OVU KOMPONENTU, KOJA CE KORISTITI CONTEXT API, KOJU CU KREIRATI, I TA BILO KOJA KOMPONENTA CE RECEIVE-OVATI posts

**src/providers/PostsProvider.jsx**

```javascript
import React, {Component, createContext} from "react"; // UVOZIM I FUNKCIJU createContext

import { firestore } from "../firebase";  // NJEGA KORISTIM JER CU PREKOPIRATI SAV CODE
                                        // KOJI SE NJEGA TIACAO
                                        // CODE CU PREKOPIRATI NARAVNO IZ Application KOMPONENTE

import {collectIdsAndDocs} from "../utility"; // TREBA MI ONA FUNKCIJA
                                            // KOJA KADA SE 
                                            // GETT-UJE DOKUMENT
                                            // USTVARI KREIRA NOVI
                                            // OBJEKAT U KOJEM
                                            // SU id POSTA
                                            // I OSTALI PROPERTIJI, USTVARI
                                            // SUSEDNI PROPERTIJI
                                            // (FLATTENING OBJEKTA)
// POMENUTA FUNKCIJA KOJU SAM UVEZAO JESTE USTVARI ONA KOJA CE SE KORISTITI
// KAO CALLBACK map METODE
// UGLAVNOM VRSIM FALTTENING SVAKOG DOKUMENTA, KAKO BI ON BIO PRILAGODJEN 
// ZA 'LAKSI' CONSUMING OD STRANE ELEMNATA, KOJI CE RENDEROVATI TAJ DATA


// KREIRACU KONTEKST OBJEKAT (AKO SE SECASM OD RANIJE; MORAS KREIRATI KONTEKST OBJEKAT)
//  (1 ->) SA KOJI MAKSNIJE KREIRAS  PROVIDER-A

export const PostsContext = createContext()

//  (-> 2) ALI KREIRAS I CONSUMER-A
// I UPRAVO JE ZATO I       EXPORTED

// ODNOSNO EXPORTED JE JER CE, NJEGOVOG CONSUMER-A, KORISTITI NEKA SUBKOMPONENTA

// !!!!!!!!!!!!!!! PONAVLAJM ONO STO BI TREBAO ZNATI OD RANIJE, DAKLE CONTEXT MI OMOGUCAVA
// DA SHARE-UJEM STVARI OD NEKE 'NAD KOMPONENTE' KA NEKOJ 'POD KOMPONENTI'

            //  *********    CIME ZAOBILAZIM ONO 'MIDDLE GROUND' KOMPONENTE     ***********

// U SUPROTNOM BIH MORAO PROSLEDJIVATI PROPSE, OD KOMPONENTE DO KOMPONENTE 
            // A TO JE MUKOTRPAN POSAO   !!!!!!!!!!!!!!!!!!!!!

// KREIRACU KLASU PostsProvider

class PostsProvider extends Component {

    // OVA KOMPONENTA CE IMATI STATE
    // I ON CE SAMO SKALDISTI POSTS, KOJI SU
    // KOJI SU onSnapshot PROCITANI IZ FIRESTORE-A

    state = {posts: []}

    // TU JE NARAVNO ONAJ PROPERTI, KOJI TREBA DA REFERENCIRA (BICE MU ASSIGNED)
    // 'UNSUBSCRIPTION FUNKCIJU'

    unsubscribeFromFirestore = null;

    // SADA DAKLE KOPIRAM SAV ONAJ CODE KOJI SE TICAO SUBSCRIBINGA
    // I UNSUBSCRIBING-A SA SLUSANJA PROMENA U 'posts' KOLEKCIJI
    // CLOUD FIRESTORE DATABASE-A

    // TAJ CODE JE TAMO DEFINISAN U componentDidMount I componentWillUnmount LIFECYCLE HOOK-OVIMA

    componentDidMount = async () => {
        // SUBSCRIBUJEM SE NA PROMENE U FIRESTORE-U (ZA 'posts' KOLEKCIJU)  
        this.unsubscribeFromFirestore = firestore.collection('posts').onSnapshot(snapshot => {    //

            const posts = snapshot.docs.map(collectIdsAndDocs)

            this.setState({posts});

        })

    }

    componentWillUnmount = () => {
        // UNSUBSCRIBUJEM SE
        this.unsubscribeFromFirestore()

    }

    // DEFINISEM I render KOJI CE JEDINO SLUZITI DA
    // RENDER-UJE PROVIDER-A

    render(){

        // DA RESTRUKTURIRAM STATE, JER MI TREBA posts
        const {posts} = this.state;

        // ALI TREBACE MI I props.children

        const {children} = this.props;

        // JER KAO STO SAM REKAO, KORISTICU OVU KOMPONENTU
        // KAO 'HOLDER OF THE STATE'

        // ODNONO SVE STO BUDE PODKOMPONENTA, OVE MOJE KOMPONENTE, MOCI DA KORISTI
        // PostsContext.Consumer, KAKO BI DOBILO ONO STO PROVIDER SALJE

        // KREIRACU SADA PROVIDER, ABOUT MY posts
        // I ON CE BITI WRAPPED OKO BILO KOJE CHILD KOMPONENTE

        return (
            <PostsContext.Provider  value={posts}>
                {children}
            </PostsContext.Provider>
        );

        // NAPOMINJEM DA SE DATA (posts) DODELJUJE KAO value ,ST OSAM GORE I URADIO
    }
}

export default PostsProvider;
```

MOJA PREDPOSTAVKA JESTE DA CE React ELEMENT, KOJEG REPREZENTUJE GORNJA KOMPONENTA, UPRAVO WRAPP-OVATI React ELEMENT KOJEG REPREZENTUJE Posts (A SVE TO U POVRATNOJ VREDNOSTI render METODE Application KOMPONENTE)

## POSTO SAM KREIRAO CELU React KOMPONENTU, KOJA PREDSTAVLJA I CONTEXT-NOG PROVIDER-A, ALI I HOLDER-A STATE-A (STO IZGLEDA AMAZING, BAR MENI); SADA MOGU KREIRATI ISTO TAKO, KOMPONENTU, CIJA CE JEDINA ULOGA BITI DA RENDER-UJE CONSUMER-A

## NESTO O REDUX-U

REDUX JE NA SLICAN NACIN KORISTIO OLD CONTEXT API, KOJI JE KAZU BIO UNRELIABLE ZA KORISCENJE

PREDPOSTAVLJAM DA SU GA OVAKO KORISTILI, KAO JA SADA, KREIRAJUCI KOMPONENTE, KOJE SE 'SAMO BAVE CONTEXT-OM'

## KADA SAM JA KORISTIO CONTEXT, RANIJE, PRILIKOM UCENJA REACT-A, JA SAM CONTEXT KORISTIO NA TAKAV NACIN DA SAM GA KORISTIO SAMO KADA BI ZA NJEGA VIDEO POTVRDU, U BILO KOJIM KOMPONENTAMA

A U OVOM PRIMERU GA KORISTIM VEOMA PAMETNO, ODNOSNO STEVE KINNEY GA KORISTI, UPROSCENO RECENO, KA DEO KOMPOZICIJSKOG PRISTUPA

VEOMA JE REUSABLE