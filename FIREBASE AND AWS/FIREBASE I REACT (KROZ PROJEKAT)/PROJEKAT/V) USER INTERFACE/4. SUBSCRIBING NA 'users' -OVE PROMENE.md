# KAO STO SAM URADIO ZA DOKUMENTE IZ 'posts' KOLEKCIJE, JA TAKODJE ZELIM DA SLUSAM onSnapshot ZA DOKUMENT IZ 'users' KOLEKCIJE

DA SE PODSETIM, KAD KOD SE PROMENI NEKA KOLKECIJA, AKO SLUSAM onsnapshot, JA MOGU PRISTUPITI SNAPSHOTU KOLEKCIJE, I TO JE SNAPSHOT KOJI JE 'UHVACEN', SA SVIM PROMENAMA, KOJE SU IZVSENE NA DOKUMENTIMA

## DAKLE IDEM U KOMPONENTU UserProviderl I STVARI CE PRI REDEFINISANJU POSTATI MALO SQURELY

TO KAZEM ZATO STO CU U OVOM SLUCAJU KADA **DODAM SUBSCRPTION NA SNAPSHOT ZA DOKUMENTE U 'users' KOLEKCIJI**, JA IMATI TAKODJE I ONAJ SUBSCRIPTIO NA AUTH STATE CHANGE; ALI PORED TOGA JA IMAM I UNSUBSCRIOBING FROM AUTH STATE CHANGES; JA CU TAKODJE ZELET DA SE PRE UNMOUNTINGA UserProvider KOMPONENTE TAKODJE UNSUBSCRIBE-UJEM NA SNAPSHOTE; JEK AKAO STO SAM I GOVORIO RANIJE TO BI IZAZVALO DODATNE REQUEST-OVE FIRESTORU ON SNAPSHOT, I KADA SE STRANICA ZATVORI; A NE ZELIM POMENUTOM PTRVENSTVENO STO PREKORACENI BROJ ZAHTEVA FIRESTORE-U, MOZE IZAZVATI PREKORACENJE FREE PLAN-A

## :u6709::u6709::u6709::u6709: TRENUTO MOJA UserProvider KOMPONENTA IZGLEDA OVAKO :u6709::u6709::u6709::u6709:

MISLIM DA MOGU UCI U ZABLUDU I POMISLITI DA MORAM SLUSATI

<><><><><><><>MORAS SE VRATITI U firebase.js I REDEFINISATI createUserProfileDocument ILI ONU DRUGU FUNKCIJU; JER TI TREBA REFERENCA USER DOCUMENT*A<><><><><><><>

src/providers/UserProvider.jsx

```javascript
import React, {Component, createContext} from 'react';

import {auth, createUserProfileDocument} from '../firebase';

export const UserContext = createContext({user: null});


class UserProvider extends Component {

    state = {user: null}

    unsubscribeFromAuth = null;

  // ************************************************************
    componentDidMount = () => {

        this.unsubscribeFromAuth = auth.onAuthStateChanged(async userAuth => {

            const user = await createUserProfileDocument(userAuth);

            // MISLIM DA JE SUBSCRIBING POTREBNO OBAVITI OVDE, NA IME KADA SE ZAVRSI
            // KREIRANJE DOKUMENTA
            // RAZMISLJAM O ONOM PRVOM SLUCAJU, KOJEG SDA NEMA, ALI MISLI MDA OD NJEGA TREBA POCETI

            // GOVORIM O ONOM SLUCAJU KADA JE DODAT PRVI USER DOKUMENT U 'users' KOLEKCIJU
            // (!!!!!!!!!) TREBA IMNATI U VIDU DA PRE TOGA 'users COLLECTION
            //  NIJE POSTOJAO, I DA SE NE BIH TADA MOGAO SUBSCRIBOVATI NA SNAPSHOT-OVE

            // ALI TREBA DA VODIM RACUNA DA user MOZE BITI I null U OVOM OBIMU
            // TADA NE BIH TREBALO DA SE SUBSCRIBE-UJEM

            this.setState({user})

        })

    }

    componentWillUnmount(){
        this.unsubscribeFromAuth()
    }
  // ************************************************************


    render(){

        const {children} = this.props;
        const {user} = this.state;

        return (
            <UserContext.Provider value={user}>
                {children}
            </UserContext.Provider>
        );

    }


}

export default UserProvider;

```
