# WRITING SECURITY RULES

SADA BI TREBALO DA OTKRIJEM, KAKO I GDE TREBAM DA PISEM, POMENUTA SECURITY PRAVILA

## IDEM U KONZOLU U Database SEKCIJI, I ONOSTO CU ODMAH UCITI JESTE Rules TAB, KOJI NA SEBI IMA I :heavy_exclamation_mark: (EXCLAMATION POINT)

TO JE UPRAVO WARNING, JER KAO STO SAM REKAO RANIJE, DOZVOLJEN JE READING I WRITING BEZ OBZIRA NA SVE

DAKLE I SUVISE PERMISSIVE

KADA OTVORIM, POMENUTO VIDECU I OVAKAV WARNING

> :small_red_triangle: Your security rules are defined as public, so anyone can steal, modify, or delete data in your database

DAKLE, SASVIM JE JASNO DA OVO NIJE DOBRO

TU JE DAKLE I PRAVILO

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write;
    }
  }
}
```

*FINE FOR DEVELOPMENT*,ALI **ULTIMATIVNO LOSA STVAR**

## JA SADA ZNAM NESTO O SHAPE-U MOJIH PODATAKA; NAIME, ZNAM DA POSTOJE 'posts'; TAKO DA MOGU POCETI SA PISANJEM PRAVILA

MOGU DAKLE UKLONITI ONOS TO JE U OBIMU **match /databases/{database}/documents**

I MOGU POCETI PISANJE PRAVILA, KOJA SE TICU 'posts'

DOZVOLICU read USVAKOM SLUCAJU

A WRITE CE BITI DOZVOLJEN SAMO AKO JE KORISNIK AUTHORIZED

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /posts/{postId} {
      allow read;
      allow write: if request.auth.uid != null;
    }
  }
}
```

DEFINISUCI RANIJE ON AUTH STATE CHANE, U MOM APP-U, PROSLEDJIVAO SE OBJEKAT user KOJI JE IMAO PROPERTIJE uid, displayName ITD.

AKO JE KORISNIK NIJE LOOGED IN user JE null

A AKO JE LOGGED IN user JE ONAJ OBJEKAT, SA POMENUTIM PROPERTIJIMA

## SADA DA SACUVAM TA PRAVILA, MOGU PRITISNUTI CTRL + S, ILI PRITISNUTI Publish DUGME U KONZOLI

TREBNACE IM MINUT DA SE PROPAGATE-UJU, ALI GENERALNO RECENO, IT'S PRETTY QUICK

## MOGU OVO ODMAH TESTIRATI U MOM APP-U (PRVO KADA NISAM PRIJAVLJEN)

JA SAM SADA SIGNED OUT DAKLE

**PRIMETICU NESTO CUDNO, KADA BUDEM, POKUSAO DA KREIRAM NOVI POST** (**NESTO STO CE TRJATI, MOZDA MANJE OD SEKUNDE**) (MOZDA NIJE BITNO ALI DA IPAK POMENEM)

NOVI POST CVE NAIME BITI KREIRAN, ODNOSNO NOVI DOKUMENT CE BITI STAVLJEN U 'posts' KOLEKCIJU

KAKO TO ZNAM?

PA ZAISTA CE NOVI PSOT BITI PROSLEDJEN U STATE APLIKACIJE

AKO SE PODSETIM, SLUSANJE SNAPSHOTA CE OMOGUCITI PROMENU STATE-A

TO I NIJE SPORNO

VEC CINJENICA DA CE SE PODACI POSLATI NA FIREBASE BEZ OBZIRA DA LI JE KORSNIK AUTHORIZED ILI NE

I DA CE SE SNAPSHOT DATBASE-A DESITI, I TIME CE SE UPDATE-OVATI BAZA

ALI DESICE SE PONOVNI SNAPSHOT, JER SLUSAM PROMENE DATABASE-A ON SNAPSHOT I DESICE SE ZATO I PROMENA STATE-A  UMOJOJ APLIKACIJI

ALI TO CE SE DESTITI NA KRATKO, ODNONO ODMAH CE BITI UKLONJEN TAJ POST, JER NOVI SNAPSHOT GA NECE IMATI

A SVE CE TO BITI PRACENO ERROR PORUKOM U KONZOLI, KAKO ZAHTEV DATABASE-U NIJE AUTHORIZED

>> MOZDA OVO NIJE BILO JASNO POTREBNO OBJASNJAVATI, ALI SADA IMAM UVID DA SECURITY RULE, BIVA PRIMENJEN KADA DOKUMENT DOSPE U DATNBASE; I ONDA SE TO PRAVILO PRIMENJUJE, KAKO BI ONO PROMENE NA DATABASE-U, KOJE SU NASTALE NON AUTHORIZED PRISTUPOM, BILE I UKLONJENE

ISTA STVAR JE I U SLUCAJU KADA BUDEM PRITISKAO LIKE BUTTON NA VEC KREIRANOM POSTU; ILI KADA PRITISNEM NA DELETE DUGME POST-A

MOGU PRISTISKATI MNOGO PUTA TO DUGME

TO CE IZVRSITI UPDATE

I OPET CE SE SLATI KREIRATI NOVI SNAPSHOT-OVI

I STATE APP-A CE BITI PROMENJEN SA NOVIM BROJEM LIKE-OVA

ALI NAKON SEKUNDE, A MOZDA I MANJE, SVE SE VRACA NA POCETNO, JER OPET JE SLUCAJ ISTI, UNAUTHORIZED MENJANJE PODATKA JE SECURITY RULE 'UOCIO', I OPET CE SE U RERENDER-U PRIKAZATI ONI PODACI PRE LIKE-OVA, U SLEDECEM SNAPSHOTU

ISTA STVAR JE I KOD UKLANJANJA, ODNOSNO KADA KORISNIK UKLONI POST, ON CE SAMO NESTATI NA TREN, I POJAVICE SE OPET (DA NE DUZIM PRICU, KAKO I ZASTO, JER SAM GORE SVE OBJASNIO)

## A MOGU SE SADA SIGN IN-OVATI, WITH GOOGLE, PRITISKAJUCI DUGME, KOJE SLUZI ZA POMENUTO

SVAKA PROMENA KOJU SADA IZVRSIM KAO AUTHORIZED KORISNIK, BICE DAKLE I SPROVEDENA

SVAKI POST KOJI KREIRAM CE BITI DODAT OSTALIM POSTOVIMA

ISTA STVAR JE I SA LIKEOVIMA (DA NE OBJASNJAVAM PONOVO TAJ PROCES 'PIPLININGA' KROZ STATE)

ILI SA UKLANJANJEM POST-OVA

## ONO STO SE, INACE TREBA URADITI U SLUCAJU UNAUTHORIZED KORISNIKA, JESTE CATCHING ERROR-A, I DEFINISANJE DA SE PRIKAZE NEKI HLPFUL MODAL KOJI BI OBZNANIO KORISNIKU DA NE MOZE KAO UNAUTHORIZED KORISNIK DA KREIRA NOVE POST-OVE I DA UPDATE-UJE STARS (LIKE-OVE)

## :mega::mega::mega::mega: MEDJUTIM AUTHOTIZED KORISNICI MOGU DA UKLANJAJU POST-OVE, BEZ OBZIRA DA LI SU GA ONI KREIRALI ILI NE :mega::mega::mega::mega::mega:

## ONO STA ZELIM DA DEFINISEM JESTE DA KORISNIK, MOZE DELET-OVATI SAMO SVOJ POST; ALI PRVO DA POGLEDAM TRENUTNU SITUACIJU, U POGLEDU PRAVILA

POGLEDAJ OPET SECURITY PRAVILO, KOJE IMAM TRENUTNO

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /posts/{postId} {
      allow read;
      allow write: if request.auth.uid != null;
    }
  }
}
```

**DAKLE GORE JE writing ALLOWED, KADA JE KORISNIK AUTHORIZED**

STA TO ZNACI?

TO ZNACI DA SU I **create** I **update** I **delete** DOZVOLJENI KADA JE KORISNIK AUTHORIZED

SADA JE SITUACIJA KOD DEFINISANJA PRAVILA, MALO TRICKY

## DAKLE UPOTREBA write, KAO 'SLEDGEHAMMER-A' (ON DEFINISE SVA TRI POMENUTA PRAVILA), OVDE VISE NECE BITI DOVOLJNA, I MORACU DA DEFINISEM, POMENUTA TRI PRAVILA POJEDINACNO

ZA POCETAK SAVIM JE LOGICNO DA create TREBA DA BUDE DOZVOLJEN SVIM AUTHORIZED KORISNICIMA