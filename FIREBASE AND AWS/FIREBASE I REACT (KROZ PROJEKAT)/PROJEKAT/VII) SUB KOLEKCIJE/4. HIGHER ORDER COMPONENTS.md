# HIGHER ORDER COMPONENT

RECI CU USTVARI STA JE TO HIGHER ORDER COMPONENT

PRVO DA KAZEM DA JE TO FUNKCIJA, PA CU ONDA RECI SLEDECE

**HIGHER ORDER COMPONENT JE *KOMPONENTA KOJA RETURN-UJE ANOTHER COMPONENT***

*ON JE BASED NA HIGHER ORDER FUNCTIONS, JER JE REACT ALL ABOUT FUNCTIONAL PROGRAMING*

*DAKLE JA DAJEM HIGHER ORDER COMPONENTI, NEKU KOMPONENTU, A ONA JE WRAPP-UJE U NOU KOMPONENTU PROSLEDJUJUCI JOJ MORE PROPS*

U OVOM SLUCAJU JA ZELI MDA SE KAO DODATNI PROPS, USTVARI KORISTI user OBJECT

**I KROZ MAGIC OF JAVASCRIPT CLOSURES, SVE FUNKCIONISE KAKO TREBA**

## JA CU USTVARI KORITITI FIREBASE, Context API, KAKO BI KREIRAO TU HIGHER ORDER COMPONENT, POPUT ONE KOJU SAM KORISTIO (MISLIM NA withRouter)

JA CU DAKEL MALO CHEAT-OVATI

ODNOSNO LEVERAGE-OVACU WORK, KOJI SAM VEC ODRADIO SA **USER CONTEXT PROVIDEROM** (KOMPONENTA KOJA SVE WRAPP-UJE U PROVIDERA; A IZVOZI Context KOJI SE KORISTI)

## ALI ZELIM DA VIDIM ZASTO BI MENI OVA HIGHER ORDER COMPONENT, UOPSTE TREBALA

DAKLE, REKAO SAM DA MI JE CILJ DA, *'KROZ HIGHER ORDER COMPONENT, JA PROVUCEM MOJU KOMPONENTU'*, KAKO BI MOJA KOMPONENTA IMALA DATA O KORISNIKU

HAJDE DA SAGLEDAM *Application* KOPMPONETU, USTVARI DA SAGLEDAM *JSX, KOJI JE RETURN VALUE, TE FUNCTIONAL KOMPONENTINE*

```HTML
<main className="application">
    <Link to="/">
        <h1>Think Clone</h1>
    </Link>

    <Authentication/> <!--OVA KOMPONENTA user-A, KORISCENJEM UserContext-A
                            (KREIRANOG U PROVIDER KOMPONENTI) -->
                            <!-- UMESTO CONSUMER-A, ONA KORISTI I usecontext HOOK -->

    <!-- REKAO SAM DA CE MI TREBATI, UPRAVO POMENUTI CONTEXT IZ src/providers/UserProvider.jsx -->


                            <!-- !!!!!!!!!!!!!!!!!!!! -->
                            <!-- !!!!!!!!!!!!!!!!!!!! -->

    <!-- ONO STO ZNAM DA DONJIM ELEMENTIMA (REPRESENTED BY Route COMPONENT) -->
    <!-- JESTE DA NEMAM MOGUCNOST PROSLEDJIVANJA, KAO PROPSE-A, ZELJENIH VREDNOSTI, POMENUTIM ELEMENTIMA  -->

    <Switch>
        <Route exact path="/" component={Posts}/>

        <Route exact path="/profile" component={UserProfile}/>   <!-- OVA KOMPONENTA JE FORMULAR, KOJI SALJE
                                                                    PROFILE PICTURE I DISPLAY NAME U FIRESTORE-->

        <Route exact path="/posts/:id" component={PostPage}/>   <!-- DA BIH MOGAO PROCITATI :id JA SAM OVDE 
                                                                KORISTIO HOC, KOJI SE ZOVE      withRouter
                                                                    KOJI JE 'react-router-dom'- OVA FUNKCIJA -->

                <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

        <!-- PREDHODNA POMENUTA KOMPONENTA IMA PODKOMPONENTU, KOJA JE 'DUBOKO' -->

        <!--         PostPage   ->  Comments     ->     AddComment (TO JE OVA)            -->

        <!-- I KOJA, TAKODJE NEMA IDEJU O user-U  -->
        <!--     U PITANJU JE       AddComment      KOMPONENTA, KOJOJ JE DAKLE POTREBAN INFO O USER-U     -->


    </Switch>
</main>
```

NAIME, POMENUTA &nbsp;&nbsp;&nbsp;&nbsp; **AddComment** &nbsp;&nbsp;&nbsp;&nbsp;  KOMPONENTA JE VEC SAGRADJENA, ODAVNO

*I ONA VEC IMA, ZADATI NACIN KAKO DA KORISTI PROPSE* 

ONA KORISTI JEDNU FUNKCIJU KOJA JE FUNKCIJA PostPage KOMPONENTE PROSLEDJENA KROZ PROPSE

TA FUNKCIJA KOMUNICIRA SA FIRESTORE-OM, DODAVAJUCI NOVE DOKUMENTE U 'comments' SUBCOLLECTION, POST DOKUMNETA

CONTENT KOMENTAR-A JE ZA, TU FUNKCIJU PROVIDED OD STRANE FORMULARA AddComment KOMPONENTE

ALI KAO STO REKOH JA BIH PORED TOGA ZELEO DA DODAM DA U SKLOPU KOMENTATRA, PORED CONTENTA KOMENTARA BUDE, ISTOM
DOKUMENTU TE PODKOLEKCIJE, POSLAT I NAME AUTORA KOMENTARA, A TO JE TRENUTNO AUTHORIZED KORISNIK

POGLEDAJ

src/components/PostPage.jsx

```javascript
import React, {Component} from 'react';
import Post from './Post';
import Comments from './Comments';
import {firestore} from '../firebase';
import {collectIdsAndDocs} from '../utility';

import {withRouter} from 'react-router-dom';


class PostPage extends Component {

    state = {post: null, comments: []}

    get postId(){
        return this.props.match.params.id;
    }

    get postRef(){
        return firestore.doc(`posts/${this.postId}`);
    }


    get commentsRef(){
        return this.postRef.collection('comments');
    }


    unsubscribeFromPost = null

    unsubscribeFromComments = null


    componentDidMount = async () => {

        this.unsubscribeFromPost = this.postRef.onSnapshot(docSnap => {

            const post = collectIdsAndDocs(docSnap)

            this.setState({post})
        })


        this.unsubscribeFromComments = this.commentsRef.onSnapshot(querySnap => {

            const comments = querySnap.docs.map(collectIdsAndDocs)

            this.setState({comments});
        })

    }


    componentWillUnmount = () => {
        this.unsubscribeFromComments();
        this.unsubscribeFromPost()
    }


    createComment = comment => {

        // DAKLE REKAO SAM DA OVA FUNKCIJA DOWN THE PROPS PIPELINE STIZE
        // STIZE DO AddComment KOMPONENTE

        // TAMO BIVA POZVANA SA CELIM STATE-OM

        // KOJ ISE RESTRUKTURIRA I create-UJE SE SA TIM PODATKOM NOVI DOKUMENT U comments PODKOLEKCIJI
        this.commentsRef.add({...comment})

        // ALI, POMENUTOM STATE-U AddComment KOMPONENTE FALI USER

    }


    render(){

        const {post, comments} = this.state;

        return (
            <section>
                {post && <Post {...post}/>}
                <Comments
                    comments={comments}
                    onCreate={this.createComment}
                    postId={post && post.id}
                />
            </section>
        );

    }

}

export default withRouter(PostPage);
```

DAKLE REAKAO SAM DA STATE-U AddComment KOMPONENTE FALI USER, ODNOSNO DISPLAY NAME USER-A, KOJI KREIRA KOMENTAR

POGLEDAJ

AddComment

```javascript
import React, {Component} from 'react';

class AddComment extends Component {

    state = {content: ''};      // NIJE PREDVIDJEN USER

    handleChange = ev => {
        const {name, value} = ev.target;

        this.setState({
            [name]: value
        });
    }

    handleSubmit = ev => {
        ev.preventDefault();

        // A STATE JE PROSLEDJEN
        this.props.onCreate(this.state);
        // PS. onCreate JE ONA createComment FUNKCIJA IZ PostPage KOMPONENTE PROSLEDJENA DOWN THE PIPELINE
        // *****************************

        // UMESTO GORNJEG this.state, JA BIH TREBAO PROSLEDITI U FUNKCIJU NESTO OVAKO

        //                      this.props.onCreate({...this.state, displayName: this.props.user.displayNasme});

        // ALI KAO STO REKOH NEMAM USER-A
        // MORAM GA OBEZBEDITI, TAKO STO CU KREIRATI HIGHER ORDER COMPONENT, KOJI TOG USER-A
        // TREBA OVAOJ KOMPONENTI DA PROSLEDI KAO PROP

        this.setState({
            content: ''
        });
    }

    render(){

        const {content} = this.state;

        return (
            <form className="add_comment" onSubmit={this.handleSubmit}>
                <input
                    type="text"
                    name="content"
                    placeholder="Comment"
                    value={content}
                    onChange={this.handleChange}
                />
                <input
                    className="create_comment"
                    type="submit"
                    value="Create Comment"
                />
            </form>
        )
    }

}

export default AddComment;
```

## KREIRACU NOVU KOMPONENTU, KOJU CU NAZVATI withUser

KREIRACU JE U components FOLDER-U

src/components/**withUser.jsx** FAJL

```javascript
import Ract, {Component} from 'react';

// DAKLE IMPORT-OVACU, USER CONTEXT

import {UserContext} from '../providers/UserProvider';      // DAKLE VEC SAM RANIJE KREIRAO KOMPONENTU
                                                            // U KOJOJ SAM SVU NJENU CHILDREN
                                                            // ZAMOTAO U Usercontext.Provider KOMPONENTU
                                                            // U SUSTINI REACT ELEMENT REPRESENTED BY
                                                            // Application COMPONENT
                                                            // JE WRAPPED INSIDE PROVIDER
// DAKLE, JA SAM TAMO RANIJE DEFINISAO KORISCENJE auth-A
// SA CIJIM PODACIAM SE KREIRA NOVI DOKUMENT U 'users' KOLEKCIJI
// ZATIM JA MOGU UZ POMOC HOOK-A ILI CONSUMER-A, PULL-OVATI
// USER OBJEKAT IZ TOG CONTEXT-A

// U POMENTOJ KOMPONENTI JE DEFINISAN PROVIDER, KOJI USTVARI UZIMA user-A, KAO value
// KAKO BIGA U NEKOJ DRUGOJ KOMPONENTI MOGAO UPOTREBITI CONSUMER, ILI HOOK (useContext)

// KREIRAM DAKLE HOC, KOJOJ SE KAO ARGUMENT DODAJE NEKA KOMPONETA


const withUser = Comp => {

    // STO SE TICE CONTEXT-A, ODLUCIO SAM DA NE KORISTIM useContext HOOK,
    // VEC CU UPOTREBITI Consumer-A

    // STA SADA RADIM, PA PRAVIM React ELEMENT REPRESENTED BY COMPONENT, KOJA SE DODELJUJE
    // PARAMETRU (Comp SAM DAO IME PARAMETRU)
    // A MORAM WRAPP-OVATI SVE TO INSIDE Consumer
    // DAKLE Consumer CE SE WRAPP-OVATI OKO React ELEMENTA REPRESENTED BY PARAMETAR
    // (KOJEM SE KAO STO SAM REKAO PROSLEDJUJE KOMPONENTA)

    // Consumer MORA <Comp/> DA 'NAHRANI' SA VALUE-OM, A TO JE  user OBJEKAT, KAO STO ZNAM


    return (

    );

}


```
