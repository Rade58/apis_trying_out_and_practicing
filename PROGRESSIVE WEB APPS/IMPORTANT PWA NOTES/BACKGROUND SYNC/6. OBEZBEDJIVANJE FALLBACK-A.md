# OBEZBEDJIVANJE FALLBACK-A, U SLUCAJU DA BROWSER NE PODRZAVA

ZA TU POTREBU KREIRACU NOVU FUNKCIJU, KOJA CE SLATI DATA DIREKTNO SERVERU, BEZ IndexedDB-JA, KO MIDDLE MAN-A

PA ONDA TU FUNKCIJU POZIVAM U OBIMU elese STATEMENT-A

```javascript
const titleInput = document.querySelector('input#title');
const locationInput = document.querySelector('input#location');

const form = document.querySelector('div#create-post form');

form.addEventListener('submit', ev => {

    ev.preventDefault();


    if(titleInput.value.trim() === "" || locationInput.value.trim() === ""){
        alert("Please enter valid data!");

        return;
    }
    closeCreatingPostModal();

    if('serviceWorker' in window.navigator && 'SyncManager' in window){   // DAKLE OVO JE BITNO
                                                                          // JER SAM DOLE DEFINISAO else
        navigator.serviceWorker.ready                                     // STATEMENT, U CIJEM OBIMU
        .then(swr => {                                                    // JE FALLBACK POZVAN
                                                                          // ZA SLUCAJ DA BACKGROUND SYNC
                                                                          // NIJE PODRZAN U BROWSER-U
            let post = {
                id: new Date().toISOString,
                title: titleInput.value,
                location: locationInput.value
            }


            writeData('sync-new-post', post)
            .then(() => {
                swr.sync.register('sync-new-post');
            })

            .then(() => {

                let snackbarcontainer = document.querySelector('confirmation-toast');
                let data = {message: "Your post was saved for synching!"};

                snackbarContainer.MaterialSnackbar.showSnackbar(data)

            })
            .catch(err => {
                console.log(err);
            })

        })

    }else{      // OVO JE ELSE IZJAVA U CIJEM OBIMU EXECUTE-UJE FALLBACK

        sendData();

    }

})
```

## DA DEFINISEM POMENUTU sendData FUNKCIJU, KOJA CE SLATI PODATKE SERVERU DIREKTNO

```javascript

function sendData(){
    // NARAVNO, U OBIMU OVE FUNKCIJE, POZIVAM fetch METODU
    // KORISTICU ISTI   FIREBASE URL, KOJI SAM KREIRAO RANIJE
    fetch('https://instapwaclone.firebaseio.com/posts/json', {
        method: "POST",
        body: JSON.stringify({                  // PODATKE U ISTOM FORMATU, KOJEG SAM SLAO IndexedDB-JU
            id: new Date().toISOString(),       // SADA SALJEM DIREKTNO SERVERU
            title: titleInput.value,
            location: locationInput.value,
            image: 'https://firebasestorage.googleapis.com/v0/b/instapwaclone.appspot.com/o/burgers_food.jpeg?alt=media&token=001349ec-8c02-4c16-87df-9db24b252256'             // DEFINISAO
                                                                                                    //SAM DA
                                                                                                    //SE
                                                                                                    //SALJE
                                                                                                    //I URL
                                                                                                    //ZA
                                                                                                    //SLIKU
        }),
        headers: {
            "Content-Type": "application/json",         // DEFINISAO SAM I NEKE HEADERS-E
            "Accept": "application/json"
        }
    })
    .then(resp => {         // OVDE REAGUJEM NA RESPONSE
        console.log("Send Data: ", resp);
        // updateUI()       // OVO SAM ISKOMENTARISAO, JER MI NIJE KONKRETNO JASNO CIME BIH OVDE
                            // UPDATE-OVAO USER INTERFACE, ODNOSNO KOJI DATA BI PROSLEDIO ZA KREIRANJE
                            // NOVE KARTICE
    })
}

```

U SLEDECEM md FAJLU, BAVICU SE TIME, KAKO DA DALJE HANDLE-UJEM SYNCHRONIZATION EVENT

