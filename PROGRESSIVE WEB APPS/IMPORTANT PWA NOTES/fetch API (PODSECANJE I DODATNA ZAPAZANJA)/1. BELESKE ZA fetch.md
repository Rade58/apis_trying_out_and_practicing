# BELESKE, ONO STO SAM ZABORAVIO I DODATNE STVARI KOJE NISAM ZNAO U POGLEDU fetch API-A

POCECU OD Response INSTANCE

## O Response INSTANCI I NJENIM 'FEATURE'-IMA :full_moon:

NAPRAVICU JEDAN fetch REQUEST, A ONO STA ZELIM JESTE Request-OVA IP ADRESA (DAKLE, ZA TIM CU POSLATI REQUEST)

KORISTIM POMENUTI [httpbin.org](https://httpbin.org/), KOJI JE JEDNOSTAVAN HTTP Request & Response SERVICE

```javascript
window.fetch('https://httpbin.org/ip')
.then(function(response){
    console.log(response);
})
```

I ONO STO CE BITI STAMPANO JESTE **Response** INSTANCA

KOJA IMA SLEDECE PROPERTIJE

```JAVASCRIPT
////////////////////// NAMERNO OVAKO ODVAJAM PROPERTIJE KOJI SU Body RELATED, JER ZELIM DA SE NJIMA POSEBNO POZABAVIM

body: ReadableStream    // GOVORIO SAM NESTO O OVOME, ALI MORAM DETALJNO DA SE POZABAVIM STREAM-OVIMA

bodyUsed: false         // OVO UKAZUJE DA Body NIJE UPOTREBLJEN

// (OVI GORNJI PROPERTIJI, DA SE KOLOKVIJALNO IZRAZIM SU DOSPELI OVDE, KAO 'POSLEDICA' UPOTREBE MIXIN KONCEPTA. TI PROPERTIJI SU USTVARI PROPERTIJI KOJI SE TICU Body MIXIN-A)
//////////////////////////////////////////////////////////////////////////////////////

headers: Headers {}

ok: true

redirected: false

status: 200

statusText: "OK"

type: "cors"

url: "https://httpbin.org/ip"
```

A STA KRIJE PROTOTIP OBJEKAT, POMENUTE Response INSTANCE

ON IZMEDJU OSTALOG KRIJE SLEDECE METODE

- **array​Buffer()**

- **blob()**

- clone()

- error()

- **form​Data()**

- **json()**

- redirect()

- **text()**

U SLEDECEM DELU, ZELIM DA SE POZBAVIM POMENUTIM **body** I **bodyUsed** PROPERTIJIMA

ALI ZELIM DA SE POZABAVIM I ONIM METODAMA, KOJE SAM GORE PODEBLJAO

TE METODE (arrayBuffer(), blob(), formData(), json(), text()) SU METODE *Body* MIXIN-A

### Body JESTE MIXIN, A ON JE I ReadableStream :first_quarter_moon:

Body KAO INSTANCA NE POSTOJI, VEC SE NJENE METODE I PROPERTIJI KOPIRAJU U RELATED Response ILI request INSTANCU (PO MIXIN KONCEPTU)

[O MIXIN-IMA SAM VEC GOVORIO](https://github.com/Rade58/apis_trying_out_and_practicing/blob/master/JAVASCRIPT%20OBJASNJENJA/1.%20MIXINS.md#mixin) I NAJBOLJE JE DA NA OSNOVU ONOGA STO SAM NAUCIO O MIXINIMA, USTVARI ZAKLJUCIM: 'KAKO JE TO Body MIXIN', I 'I KAKO SU TO Request I Response INSTANCE IMPLEMENTIRALE POMENUTI MIXIN'

ONO STO CU SAMO RECI, POSTO JE Body MIXIN, TO DAJE MOGUCNOST Response INSTANCI DA KORISTI, NJEGOVE PROPERTIJE I METODE

PROPERTIJE:

- body

- bodyUsed

I METODE

**POVRATNA VREDNOST, SVAKE OD OVIH METODA JESTE Promise INSTANCA, KOJA JE RESOLVED, SA PODACIMA, U ODGOVARAJUCEM FORMATU (ZAVISI OD METODE DO METODE)**

- arrayBuffer() &nbsp;&nbsp;&nbsp;&nbsp; OVO CU ZAOBICI ZA SADA JER SE RADI O BINARNIM PODACIMA

- blob() &nbsp;&nbsp;&nbsp;&nbsp; OVO CU ZAOBICI ZA SADA JER SE RADI O BINARNIM PODACIMA

- formData() &nbsp;&nbsp;&nbsp;&nbsp; **(RELEVANTNO SAMO KOD INTERCEPTIONA REQUESTA U SERVICE WORKER-U)** (OVIM CU SE POZABAVITI TOKOM DALJEG UCENJA SERVICE WORKERA)

- json() &nbsp;&nbsp;&nbsp;&nbsp; **(OVO JE JASNO, KORISTIO I RANIJE)**

- text() &nbsp;&nbsp;&nbsp;&nbsp; **(OVO JE JASNO, KORISTIO I RANIJE)**

```javascript
window.fetch('https://httpbin.org/ip')
.then(function(response){

    response.json()                 // DAKLE OVDE JE Response OBJEKAT KORISTIO METODU Body MIXINA

    return response;
})
.then(function(response){

    return response.body;            // A OVDE JE Response KORISTIO PROPERTI Body MIXIN-A
})
```

BODY MIXIN JE STREAM

body PROPERTI REFERENCIRA ReadableStram INSTANCU

**ZNAM OVO O READABLE STREAM-U**:

>> Streaming involves breaking a resource that you want to receive over a network down into small chunks, then processing it bit by bit. This is something browsers do anyway when receiving assets to be shown on webpages — videos buffer and more is gradually available to play, and sometimes you'll see images display gradually as more is loaded.

I SAZNAO SAM DA SE JEDAN READABLE STREAM, MOZE UPOTREBITI SAMO JEDNOM, ODNOSNO, MOZE SE SAMO JEDNOM PROCITATI

*A STA TO USTVARI ZNACI, UPOTREBITI SAMO JEDNOM, A STO BI BILO VAZNO ZNATI IZ MOJE PERSPEKTIVE*?

- **PA SAMO JEDNOM SE MOGU PRIMENITI METODE, KOJE SAM GORE POMENUO, NA ISTOJ ReadableStream INSTANCI**

TAKO DA OVO **NIJE DOZVOLJENO** (ODNOSNO PROIZVESCE ERROR)

```javascript
window.fetch('https://httpbin.org/ip')
.then(function(response){

    response.json().then(function(data){
        console.log(data)
    })

    response.text()     // ERROR  (...body stream is locked...)
})
```

**KAO STO VIDIM U GORNJEM PRIMERU JE DOSLO DO ERROR-A, JER SAM BODY POKUSAO DA UPOTREBIM, ODNOSNO DA GA PROCITAM, PO DRUGI PUT**

EVO JOS NESTO O STREAMOVIMA

CITATI IZ [Streams API MDN CLANKA](https://developer.mozilla.org/en-US/docs/Web/API/Streams_API)

>>> Streaming involves breaking a resource that you want to receive over a network down into small chunks, then processing it bit by bit. This is something browsers do anyway when receiving assets to be shown on webpages — videos buffer and more is gradually available to play, and sometimes you'll see images display gradually as more is loaded.

### OSTALI PROPERTIJI I METODE Response INSTANCE (ONE METODE I PROPERTIJI, KOJE NISU UZETE OD Body MIXIN-A) :first_quarter_moon:

PROPERTIJI:

- headers

VREDNOST JE Headers INSTANCA (GOVORICU O NJOJ KADA SE BUDEM BAVIO Request INSTANCOM)

- ok

BOOLEAN true, AKO JE status OD 200 DO 229 (USPESAN RESPONSE), A U SUPROTNOM false

- redirected

BOOLEAN false ILI true (OVIM CU SE DODATNO POZABAVITI, KADA BUDEM UCIO HTTP PROTOKOL DETALJNIJE)

- status

ODGOVARAJUCI STATUS CODE (TO JE USTVARI TROCIFRENI BROJ) (AKO JE OD 200 DO 229 ONDA JE RESPONSE USPESAN) 

- statusText

SVAKI STATUS CODE, IMA I ODGOVARAJUCI TEXT, ODNOSNO MESSAGE; I VREDNOST OVOG PROPERTIJA JE MESSAGE ZA RELATED STATUS CODE (AKO JE STATUS CODE 200, ONDA)

- type

VREDNOST MOZE BITI "basic", "cors", "error", "opaque", "opaqueredirect"

- url

VREDNOST JE URL RESPONSE-A

OVDE CU OSTAVITI MDN-OV LINK, SVIH [HTTP STATUS CODE-OVA](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

ALI CU OSTAVITI LINK SVIH [HTTP HEADER-A](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

### put METODA Cache-OVOG PROTOTIPA, USTVARI CONSUMES (KONZUMIRA) body :first_quarter_moon:

DA LI TO ZNACI DA GA CITA I DA SE ONDA VISE, NAKON VADJENJA IZ CACHE-A, NE MOZE CITATI, MORAM PROVERITI