# RANIJE SAM MOZDA NAPOMENUO DA workbox.routing.registerRoute(), MOZE IMATI I CUSTO MHANDLER, KAO PRVI ARGUMENT

TO UPRAVO PREDSTAVLJA MESTO GDE MOGU DEFINISATI SVOJU STRATEGIJU ILI KORISTITI INDEXED DB

JA IMAM KONKRETA NSLUCAJ ZA TO U MOM PRIMERU

ILI MOGU DEFINISATI OBEZBEDJIVANJE ONOG OFFLINE FALLBACK PAGE-A, KOJI TAKODJE IMAM U CODE-U, MOG PRIMER-A

ALI PRE TOG APAR STVARI KOJE TREBAM ZNATI

## U SUSTINA KADA SAM GOVORIO O workbox.routing.registerRoute(), MOGUCIM ARGUMENTIMA, REKAO SAM DA SU MOGUCE TRI TIPA VREDNSOTI, KAO PRVI ARGUMENT

MENE ZANIMA SADA CALLBACK, JER U NJEGOVOM OBIMU MOGU PISATI SVOJ CUSTOM CODE ZA SERVICE WORKER-A, KAO STO JE KORISCENJE INDEXED DB-JA

## JA USTVARI ZELIM DA KORISTIM NOVIJU VERZIJU INDEXED DB-JA, ZATO CU DA JE NA OVAKAV NACIN UVEZEM U MOJ PROJEKAT (ALI JA NECU MOCI KORISTITI NOVIJU VERZIJU, JER AUTOR VERZIJE JE OBEZBEDIO SAMO JAVASCRIPT MODULE CJS ILI ESM (ILI JE OBEZBEDIO I VERZIJU, KOJA MOZE DA SE KORISTI BEZ MODUL SINMTAKSE, A JA NE ZNAM DA JE PRONADJEM))

ZA TO MORA S ISPITATI CDN I VERZIJE NA CDN-U

INDEXED DB JA UZIMAM SA OVOG CDN-A

<https://unpkg.com/>

OBJASNJENO TI JE NA POMENUTOJ STRANICI, KAKO DA ACCESS-UJES LIBRARY

*public/index.html*

```html
<!-- DNO BODY TAGA -->
    <script src="/src/js/material.min.js"></script>

    <!-- LIBRARY KORISTIM KAO JAVASCRIPT MODUL -->
    <script type="module" src="src/js/modernIDB.js"></script>  <!--KORISTICU IPAK MODERNU VERZIJU I TO KAO JAVASCRIPT MODUL-->


    <script src="/src/js/idb.js"></script>   <!-- OVO JE ONA STARIJA VERZIJA KOJU SAM KORISTIO SA MOG DOMENA -->
    <script src="/src/js/utility.js"></script>

    <script src="/src/js/feed.js"></script>
    <script src="/src/js/app.js"></script>
```

EVO KAKO JE MOGU KORISTITI SA JAVASCRIOPT MODULIMA

*public/src/js/modernIDB.js*

```javascript
import {openDB, deleteDB, wrap, unwrap} from 'https://unpkg.com/idb?module';            // DAKLE I OVAKVA SINTAKSA U JAVASCRIPTU JE SADA MOGUCA
                                                                                        // RANIJE JE OVAKVA SINTAKSA BILA MOGUCA U WEBPACK-U,
                                                                                        // KOJI JE IPAK KORISTIO SVOJE MODULE, ALI U SKLADU SA
                                                                                        // JAVASCRIPT SINTAKSOM
                                                                                        // NARAVNO WEBPACK JE I DALJE MOCNIJI

// DAKLE MOGU KORISTITI SADA LIBRARY OVDE; I OVO JE SCRIPT DAKLE KOJI JE INSERTED INTO THE DOM

console.log("MODERN INDEXED DATBASE:", {openDB, deleteDB, wrap, unwrap});     // OVO CE BITI STAMPANO JER CHROME PODRZAVA ESM OD VERZIJE 60
```

CDN LINK IMA GORE '?module' I JASNO JE DA SAM KORISTIO JAVASCRIPT MODUL

NAIME ESM MODULI SE NE MOGU KORISTITI U SERVICE WORKER-U I ZATO NIJE MOGUCE DA KORISTIM TAKVU VERZIJU

NA ISTOM CDN-U MOZES NACI I DRUGE VERZIJE, NA PRIMER OVAKO

<https://unpkg.com/idb@4.0.4/build/cjs/index.js> (DAKLE MOZES DODAVATI OVOM PATHU STVARI I GLEDATI STA TI TREBA)

POMENUTO JE COMMON JS MODUL, STO OPET NIJE PODRZANO U SERVICE WORKER-U

DAKLE IPAK CU MORATI KORISTITI STARIJU VERZIJU, JER NOVIJU VERZIJU SAM USPEO SAMO DA UVEZEM U JAVASCRIPT, KOJI JE INSERTED INTO THE DOM

## STO SE TICE NAJNOVIJE VERZIJE KOJA KORISTI MODUL SINTAKSU, NADAM SE DA CU SAZNATI, KAKO BIH MOGAO KORISTITI TU VERZIJU, KADA BUDE MOJ PWA GRADIO SA WEBPACK-OM I KORISTIO WORKBOX, PRI TOME

DA, POSTOJI POTPUNO DRUGACIJI NACIN KORISCENJA WORKBOX-AM, KADA SE PROJEKAT BUNDLE-UJE SA WEBPACK-OM

## JA SAM USTVARI NA <https://unpkg.com/> PRONASAO I STRIJU VERZIJU, KOJA NE KORISTI MODULE, ALI VEC SAM TU VERZIJU IMAO RANIJE U MOM CODEBASE-U, TAK ODA CU NJU KORISTITI

EVO JE TA VERZIJA <https://unpkg.com/idb@2.0.0/lib/idb.js>

JA OVDE CISTO OSTAVLJAM LINKOVE DA BI TI UKAPIRAO SAMO KAKO DA TRAZIS VERZIJE I OSTALE STVARI, PUTEM OVAKVOG CDN

## STO SE TICE NPM, I TAMO IMAS SPRIKAZANE SVAKU VERZIJU, I MOZES BROWSE-OVATI KROZ RAZLICITE VERZIJE, KAKO BI PRONASAO KOJA TI TREBA

## OVU STARIJU VERZIJU KOJU SAM UZEO, KOMOTNO MOGU DA UVEZEM  USERVICE WORKER SA importScripts I SERVICE WORKER NECE THROW-OVATI ERROR ZBOG UNSUPPORTED SINTAKSE

## :koko::koko::koko::koko: MEDJUTIM, JA VEC IMAM TU VERZIJU I KORISTICU JE SA MOG DOMENA :koko::koko::koko::koko:

ONA SE NALAZI NA public/src/js/idb.js

ODNOSNO VEC IMAM UTILITY FAJL GDE SAM DEFINISAO ODREDJEN METODE ZA HANDLE-OVANJ INDEXED DATABASE-A

EVO TO JE OVO

public/src/js/utility.js

```javascript
const dbPromise = idb.open('news-store', 2, function(db){

    if(!db.objectStoreNames.contains('posts')){
        db.createObjectStore('posts', {keyPath: 'id'})
    }

    // NAZVACU NOVI STORE:   sync-posts
    if(!db.objectStoreNames.contains('sync-posts')){
        db.createObjectStore('sync-posts', {keyPath: 'id'/* , autoIncrement: true */});   // ISTO CE POSTOJATI id PROPERTI, KOJI UNIQUELY
    }

})

const writeData = function(storeName, data, key){
    return dbPromise.then(function(db){
        let transaction = db.transaction(storeName, 'readwrite');
        let store = transaction.objectStore(storeName);
        if(key) {store.put(data[key])} else {store.put(data)}
        return transaction.complete;
    })
}

const readAllData = function(storeName){
    return dbPromise.then(function(db){
        let transaction = db.transaction(storeName, 'readonly');
        let store = transaction.objectStore(storeName);
        return store.getAll();
    })
}

const clearAllData = function(storeName){
    return dbPromise.then(function(db){
        let transaction = db.transaction(storeName, 'readwrite');
        let store = transaction.objectStore(storeName);
        store.clear();
        return transaction.complete;
    })
}


// OVDE CU DEFINISATI NOVE FUNKCIJE, I OPET IMAJ NA UMU DA MORAS RETURN-OVATI transaction.complete
// ONDA KADA WRITE-UJES U DATABASE I DA NE MORAS NISTA RETURN-OVATI KADA CITAS IY DATABASE-A

const deleteItemFromData = function(storeName, itemId){

    return dbPromise.then(function(db){

        let transaction = db.transaction(storeName, 'readwrite');

        let store = transaction.objectStore(storeName);

        store.delete(itemId);

        return transaction.complete;
    })
}

const getItemFromData = function(storeName, itemId){

    return dbPromise.then(function(db){

        let transaction = db.transaction(storeName, 'read');

        let store = transaction.objectStore(storeName);

        return store.get(itemId);

    })
}

// KAO STO VIDIS ONO STO SE KORISTI JESTE idb OBJEKAT, I ON JE LIBRARY

// TREBALO BI MI MALO PODSECANJE


// ALI TAKODJE OVA VERZIJA IMA MANU, KOJA SE OGLEDA U SLEDECEM


//          https://www.npmjs.com/package/idb/v/2.0.0#transaction-lifetime


```

## :aerial_tramway::aerial_tramway::aerial_tramway: KAD SAM SE TOGA PODSETIO, MOGU DA SE VRATI MSA DEFINISANJEM HANDLER-A, ZA  workbox.routing.registerRoute() METODU, KAK OBI PIASO MOJ CUSTOM CODE U KOJE MOGU HANDLE-OVATI POMENUTI INDEKSIRANI DATABASE BROWSERA:aerial_tramway::aerial_tramway::aerial_tramway::aerial_tramway:

