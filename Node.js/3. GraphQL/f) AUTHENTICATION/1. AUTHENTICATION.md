# AUTHENTICATION

AUTOR WORKSHOPA OVO VEOMA VOLI, JER KAZE DA YOU CAN DO ANYTHING

I KAZE DA:

## POSTOJI MNOGO NACINA ZA AUTH

**NE POSTOJI WRONG WAY**

OVO SU NEKI OD NACINA, KOJIM SE MOZE AUTHENTICATE WITH GRAPHQL

### :one: LOCK DOWN ENTIRE API, TAK OSTO CES CHECK-OVATI AUTH, OUTSIDE OF GRAPHQL, ILI KADA SE KREIRA CONTEXT OBJECT

- PRIMER ZA OUTSIDE APPOLO BI BIO SLEDECE

>>>> o right now, the only application we have on our server is an ApolloServer, but let's say that we had an express application that had some other routes on it. And then for slash GraphQL we mounted an ApolloServer there.
>>>> That means we could just authenticate before the ApolloServer even executes, on some middleware before that, and that way we're authenticating before GraphQL even boots up. Before the request even gets to GraphQL, we authenticate. So that's authenticating outside of GraphQL. So you will lock down the entire GraphQL path for authentication.

- PRIMER ZA CONTEXT OBJECT BI BIO SLEDECI

POGLEDAJ server.js FAJL IZ REPO-A

```javascript
import { ApolloServer } from 'apollo-server'
import { loadTypeSchema } from './utils/schema'
import { merge } from 'lodash'
import config from './config'
import { connect } from './db'
import product from './types/product/product.resolvers'
import coupon from './types/coupon/coupon.resolvers'
import user from './types/user/user.resolvers'

const types = ['product', 'coupon', 'user']

export const start = async () => {
  const rootSchema = `
    schema {
      query: Query
      mutation: Mutation
    }
  `
  const schemaTypes = await Promise.all(types.map(loadTypeSchema))

  const server = new ApolloServer({
    typeDefs: [rootSchema, ...schemaTypes],
    resolvers: merge({}, product, coupon, user),
    context({ req }) {
      
      // DAKLE JA U OVOM SLUCAJU NEMAM EXPRESS SERVER, VEC SAMO Appolo

      // POSMATRAJ OVO
      // OVDE U OVOJ FUNKCIJI TI IMAS PRISTUP     req-U     ODNSNO Request-U, KOJI DOLAZI OD CLIENT-A

      // NA TOM req OBJEKTU BICE headers.authoriaztion STUFF, TOKENS, QUERY STRINGS
      // DAKLE SVE STA TI TREBA FROM REQUEST DA BIH VIDEO DA LI JE NEKO AUTHENTICATED

      // **** IF YOU DON'T LIKE WHAT YOU SEE, THROW AN ERROR AND NO QUERY WILL BE EXECUTED

      // OVO JE NACIN AUTH-A KOJ ICU JA RADITI, TOKOM VEZBE, ALI CU TAKODJE KORISTITI U KOMBINACIJI
      // SA NACINOM AUTH-A, KOJI JE U OVOM MD FAJLU ZAVEDEN POD 2

      return { user: null }
    }
  })

  await connect(config.dbUrl)
  const { url } = await server.listen({ port: config.port })

  console.log(`GQL server ready at ${url}`)
}

```

### :two: HANDLING AUTH-A U RESOLVERIMA

TU TREBAM DA VODIM RACUNDA DA ENHANCE-UJEM CONTEXT OBJECT SA SVI MSTVARIMA KOJE SU MU POTREBNE

A ENHANCE-UJEM GA UPRAVO NA MESTU GDE SAM POMENUO GORE U server.js FAJLU

TO JE ZATO STO SE DALJE CONTEXT PROSLEDJUJE RESOLVERIMA, I ON JE NJIHOV TRECI ARGUMENT

NA PRIMER TI NA TAJ OBJEAKT MOZES ZAKACITI *req.headers.authorization* STUFF

KAO STO SAM REKAO JA CU SE U VEZBI BAVITI, OVOM NACINOM I PREDHODNIM NACINOM KOJI JE GORE OBJASNJEN U server.js FAJLU

### :three: KORISCENJE CUSTOM DIRECTIVES U TVOM SDL (SCHEMA DEFFINITION LANGUAGE-U)

OVO JE NESTO NOVO

A TO JE MOGUCNOST DA SE SALJE METADATA SA TVOJIM SCHEMA-MA

POGLEDAJ VIDEO (U SUSTINI PORED NEKIH FIELD TYPE-OVA SE DODAJU `@(role: "Admin")`)

TE DIREKTIVE TI MORAS NAPRAVITI PRE NEGO IH UPOTREBIS U SCHEMA-MA

S OVIM MOZES ZAKLJUCATI SPECIFIC FIELDS KOJ ITREBAJU AUTHENTICATION

ALI OVO SE MOZE POSTICI I KADA AUTHENICATUJEM INSIDE RESOLVERA, ISTO TAKO TAMO MOGU CHECKIRATI ODREDJENI FIELD, PROVERITI JEDAN SPECIFIC FIELD

DAKLE SAME WAY SAMO STO JE JEDAN DEFINED ON SCHEMA, A DRUGI U OBIM URESOLVER-A

### :four: MOZE SE ISTO KORISTITI 'USE RESOLVER MIDDLEWARE' KOJI POSTOJI U NEKIM FRAMEWORK-OVIMA (NE U SVIM)

AppoloServer TO NE PODRZAVA

U SUSTINI IMAS FUNKCIJU KOJA RUNN-UJE PRE I FUNKCIJU KOJA RUNN-UJE POSLE RESOLVER-A I TO MOZE BITI AUTHENTICATION

JEDINI FRAMEWORK KOJI TO SADA PODRAZAVA JE graphql yoga

### I POSTOJE I DRUGI NACINI ALI OVO SU ONI KOJE AUTOR WORKSHOPA POZNAJE

## ON OSTO MOZES VIDETI, ODNSNO ZAKLJUCITI SU DA SVI OVI NACINI IMAJU TRADE OFF-S

AKO RADIS AUTHENTICATION OUTSIDE GRAPHQL, ODNA CES ZAKLJUCATI CEO API

NECES NA PRIMER MOCI DA RADIS SIGNUP AND SIGN IN KROZ GRAPHQL JER MORAS BITI AUTHENTICATED

AKO HANDLE-UJES AUTH U RESOLVERIMA TO TI DAJE SUPERIOR CONTROLL, ALI MOZE BITI VEOMA TEDIOUS, AKO IMAS DOSTA RESOLVERA

CUSTO MDIRECTIVES BI MOZDA BIO NAJCISTIJI NACIN, ALI ONO STO MORAS NAPISATI SU CUSTOM DIREKTIVE, A TO NIJE SIMPLEST TASK

USING RESOLVER MIDDLEWARE JE EASY, ALI SAMO RADI U CERTAIN FRAMEWORK-OVIMA

## NA TEBI JE DA IZABERES STA CES KORISTITI ZA AUTHENTICATION

TO MOGU BITI JWTs

U OVOM SLUCAJU JA NECU IMATI JASON WEB TOKENS VEC SAMO PUBLIC API KEY, POSTO JE NA PRIEMR MOJ API, NEKI PUBLIC API

API KEY CU KORISTITI ZA AUTHENTICATION, PA TAKODJE I ZA IDENTIFIKACIJU USER-A, I ONDA ZA AUTHORIZATION, AKO SU ABELE TO DO SOMETHING DEPENDING ON THEIR ROLE
