# Nginx FILE COMPRESSION

RANIJE, TOKOM PR DELA WORKSHOP-A, SPOMENUT JE *BROTLI*

POSTOJI USTVARI DVA BASIC TYPE-A COMPRESSION-A, KOJI SE RADE NA SERVERIMA

**brotli** I **gzip**

SJAJNA STVAR JE STO Nginx IMA OVO TURNED ON PO DEFAULT-U, I TO STO JE TURNED ON SE ZOVE gzip

## STA JE TO COMPRESSION, UOPSTE?

KAKV BI TREBAO DA BUDE MENTAL MODEL ?

TO JE USTVARI **STAVLJANJE INFORMACIJE U SMALLER CONTAINER** (NEKO JE REKAO DA JE TO I DO DUPLICATION)

ONO STO POSTOJUI JESTE **LOSSY** AND **LOSSLESS** COMPRESSION

EVO JEDNOG SLIKOVITOGOBJASNJENJA ZA OVE DVE VRSTE COMPRESSION-A

>> LOSSLESS JEA POPUT SAVIJANJA PADOBRANA, TI GA SAVIJES PAZLJIVO, I STAVIS GA U SMALLER CONTAINER AS POSSIBLE

>> LOSSY JE POPUT UZIMANJA MOTORNE TESTERE I SECENJA PADOBRANA, TAKO DA BI ODBACIO ONE DELOVE, HOPEFULLY NOBODY WILL CARE ABOUT, AND HOPEFULLY NOBODY WILL NOTICE, I HOPEFULLY PADOBRAN CE FUNKCIONISATI

NA PRIMER MP3 JE LOSSY COMPRESSION ALGORITHM

>> So if you've ever seen a WAV file, WAV files are unmodified lossless ways of recording audio and in the days of dial-up Internet, they were huge.

TI NISI MOGAO SHARE-OVATI WAV FAJLOVE, JER SU MOGLI DA BUDU I 200 DO 500 Mb, ZA JEDNU PESMU, I TO JE INSANE ZA DIAL UP, SLANJE BI MOGLO DA POTRAJE GODINAMA

ZATO SU IZMISLILI **MP3** STO ZNACI **MP layer 3** (A MP STANDS FOR *MOTION PICTURE EXPERT GROUP*)

>> ONO STO SU URADILI JESTE UZELI SU WAV FILE, ONO STO JE UNDER THE HOOD JESU VAWEFORMS, KOJI TALASASTO IDU UP AND DOWN, I DOSLO SE DO REALIZATION-A, DA TE TALASE LJUDSKO UHO NE MOZE NI CUTI I ODLUCILI SU DA IH CHOP-UJU OUT I DOBILI SU MP3, I TAK OSU OD 200 Mb STIGLI DO 2 Mb

DEAO UMETNOSTI U VEZI COMPRESSIONA JESTE ZNANJE O TOME STA SE MOZE TAKE-OVATI OUT

## IN TERMS OF SERVER COMPRESSION, ONO STO SE RADI JESTE, "HEY, OVAJ FAJL SAYS rade, rade, rade, rade, rade, rade..."; ONO STA MOGU URADITI JESTE KOMPRESOVATI TO UZ KREIRANJE PSEUDO PROGRAMSKOG JEZIKA, JKOJI KAZE "rade PUTA 20", UMETO DA "rade" REPET-UJEM 20 PUTA

TO JE DAKLE ESENCE OF COMPRESSION

TAKO DA AKO RAZMISLAJ O NULAMA I JEDINICAMA, ODNSNO AKO KAZES DA NA PRIMER OVAJ BLOK IMA 10 NULA, A OVAJ DRUGI BLOK IMA 10 JEDINICA, SAMO POSALJI TE INSTRUKCIJE SERVERU,  IONDA CLIENT MOZE DA UNPACK ILI UNCOMPRESS-OVATI TE STVARI

NA TAJ NACIN TI MOZES IMATI REALLY REALLY SMALL PAYLOADS, KOJE MOGU UNLOAD-OVATI, NESTO STO JE HUGE

## POSTOJI NESTO STO SE ZOVE I `gzip BOMBA`, ILI `zip BOMBA`

JA CU UZETI NESTO STO US SEBI IMA NESTO rade, A TOGA rade, IMA 38 PUTA

ALI STA AKO JE rade SELF REFERENCING LOOP, I TO SE UNPACK-UJE

I TVOJ FILE SYSTEM EKSPLODIRA, I TAK OSE MOGU TAKE-OVATI DOWN ENTIRE SYSTEMS

*TO SE UPRAVO ZOVE ZIP BOMB*

ONE I DANAS RADE, I NE POSTOJ IDOBAR NACIN DA SE DISABLE-UJU

ZATO NA INTERNETU NEMOJ DA DOWNLOAD-UJES RANDOM FILES

## DA BI INTERNET UCINIO NESTO BRZIM Nginx AUTOMATSKI COMPRESS-UJE SVE U STANDARDNI FORMAT, KOJ ISE ZOVE **gzip**

IT STANDS FOR *GNU zip* (PRODUCTSI GNU-A SE KORISTI SVUGDE)

ONO STA RADI gzip JESTE COMPRESS-UJE ALL THIS DATA GOING OUT I CITA GA U, ONIM FORMATOM, KAKO SAM DESCRIBE-OVAO RANIJE, ODNOSNO AKO JE TU DOSTA NULA I JEDINICA, ON TO REWRITE-UJE LANGUAGE-OM, KOJI SVI RAZUMEMO

ONO STO JE SJAJNO JESTE DA SVI WEB BROWSER-I, KAO STO JE SAFARI, INTERNET EXPLORER, SAMSUNG INTERNET, RAZUMEJU KAK ODA UNPACK-UJU gzip FILE, I TO CINI TVOJU KONEKCIJU, SO MUCH FASTER

IN FACK ONO STO CU URADITI JESTE OTICI CU NA MDN WEB STRANICU I VIDETI STA ONI RADE

INSPECT-OVACU (OTVORICU DEV TOOLS, PA IDEM U NETWORK)

ONO STO CU PRIMETITI SU DA FAJLOVI IMAJ TWO SIZES (AL ITEK KADA PODESIS U OKVIRU NETWORK SEKCIJE NA MALI OBLI ZUPCANIK, TU BIRAS 'Use Large Request Rows' (DAKLE VECI REDOVI, I MOZES VIDETI OBA SIZE-A))

GLEDAS DAKLE SIZES KOLONU, I VIDIS DA SVAKI FILE IMA, GORNJA JE COMPRESSED SIZE, A DONJA UNCOMPRESSED SIZE

TU VIDIS POWER OF COMPRESSING THINGS

INSTEAD OF SENDING DOWN FILE OF OKO 300 Kb, TO BIVA COMPRESSED INTO 38 Kb

SJAJN STVAR U VEZI Nginx-A JE STO ON OVO RADI ON THE FLY

AKO SALJES IMAGE-OVE, NGINX CE IF AUTOMATSKI GZIP-OVATI, I TO AKO OSTAVIS TAJ SETTING NGINX, JER ON JE PO DEFAULTU TAKAV

>> And it'll serve these images compressed and then when it hits the client it'll unpack them for you.

USTVARI ISPRAVKA, SLIKE NISU COMPRESSED, JER ONE PO DEFULT-U, KOJE KORISTE PNG ILI JPEG SU ALREADY COMPRESSED

JEDINO AKO JE SLIKA NA PRIMER U FORMATU TITMAP-A (BMP), MZODA BI MOGAO NJU DA COMPRESS-UJEM, ZTO STO JE TO UNCOMPRESSED FILE (AL IZATO SE BITMAP VISE I NEVIDJAJU KAO NESTO STO SE SERVIRA INTERNET-OM ANYMORE)

>> So images in particular serve well to compression it because what is an image? It's a series of dots that are certain colors and if those dots it's just math. And if I know I have 50 blue dots or if I wanna represent say, this board right here it's all one color this will compress really well. So I can just say, how big is the size? 600 by 800 and it's all the same color I can compress that down to one line essentially. And that's what makes image compression really powerful in PNG but that's why you can't gzip them. You can if you really, really want to, you'll just actually add overhead to it because you're now adding a zip around something that's already compressed.So what you're doing is you're adding unnecessary instructions to something that it's not gonna do anything.

## AKO ZELIS DA POGLEDAS gzip SETTINGS, I A LOT OF OTHER SETTING MOZES POGLEDATI `nginx.conf`

/etc/nginx/nginx.conf

```linux
##
# Gzip Settings
##

gzip on;
# gzip_vary on;
# gzip_proxied any;
# gzip_comp_level 6;
# gzip_buffers 16 8k;
# gzip_http_version 1.1;
```

TO NECU PIPNUTI U OVOM WORKSHOP-U

ALI AKO POGLEDAS VIDECES DA JE gzip ON BY DEFAULT

ONO STO TAM OMEZES VIDETI JESU COMPRESSION LEVELI (IDU U OPSEGU OD 1 DO 9)

JEM KAZE DA SE ON NE BI MNOGO MESS-OVAO SA COMPRESSION LEVELIMA

TEMPTING JE DA DEFINISES ALL UP TO 9

ALI TADA TI BI TRADE-OVAO OFF DOSTA CPU PAOWER-A, KOJI BI COMPRESSOVAO ALL THIS THINGS, I RUN-OVAO KROZ COMPRESSION ALGORITHM, VERSUS AMOUNT OF BYTES YOU'RE SAVING

NIVO 6-4 PRETTY GOOD, GDE TI TRADE-UEJ OF SPEED FOR PERFORMANCE

GOING HIGHER JE REALLY TEMPTING, ALI ISKRENO NE BIH USTEDEO THAT MUCH

I POSTOJI JOS OPTIMIZACIJA KOJE SE MOGU URADITI
