# UNCOMPLICATED FIREWALL

AUTOR WORKSHOPA, JE U RNIJIM VERZIJAMA WORKSHOPA OBJASNJAVAO, O IP TABLICAMA (**IP TABLES**), KOJI SU NAČINI USMERAVANJA (ROUTING), BLOKIRANJA (BLOCKING) ILI USKRAĆIVANJA (DENYING) REQUEST-A, ODREĐENIM PORTOVIMA PREKO ODREĐENIH PROTOKOLA. ALI **IP TABLES** SU ZAISTA TESKI (ONEROUS)

```linux
ip tables -p tcp --dport 80 -j REJECT
```

VIDIS GORE SINTAKSU, TO NIJE BAŠ PRIJATELJSKA SINTAKSA.

SREĆOM, LJUBAZNI LJUDI IZ OPEN SOFTWARE FONDACION I UBUNTU-a I LINUX-A, I SAMO GOOD CITIZENS NA INTERNETU, STVORILI SU NEŠTO STO LAKŠE

A TI SE ZOVE:

## **ufw**, ODNOSNO NEKOMPLICIRANI FIREVALL

OVO ĆE BITI MNOGO MANJE KOMPLIKOVANO. I OPET, FIREVALL SAMO KONTROLIŠE ACCESS TO ODREDJENE PORTS-E I KO MOŽE DA UĐE I IZAĐE SA VAŠEG RAČUNARA.

ZA RAZLIKU OD IP TABELA, ufw IMA MNOGO JEDNOSTAVNIJU SINTAKSU ZA BASIC SERVICES

```linux
            http
            https
$ ufw allow ssh
      dany
      reject

```

DAKLE, AKO ŽELIM DA DENY-UJEM HTTPS MOGU REĆI

- ufw deny https

I MNOGO JE LAKŠE REZONOVATI, AKO RAZMISLJATE, O SERVICE LEVELU, TATHET THAN PORT LEVEL-U; I NE MORAM MISLITI, ŽELIM DA BLOKIRAM SAV TCP TRAFFIC DO PORTA 4470. NE, MOGU SAMO REĆI DA

- ufw deny https

I BLOKIRAĆE SAV SAOBRAĆAJ DO PORTA 443 (433 JE PORT ZA https)

## KOJA JE RAZLIKA IZMEDJU deny I reject

**deny** USTVARI 'BLACK HOLE'-UJE REQUEST-OVE, AKA IT DOESN'T RESPOND TO REQUESTS

NA PRIMER AKO POKUSAM DA GET-UJEM IN PORT 47, MOGU DAKLE PINGOVATI TAJ PORT ILI POKUSATI DA GA ACCESS-UJEM; I O NCE SAMO HANG-OVATI I HANGOVATI

**ALI INTERNALY, JA SAM VEC DROP-OVAO TAJ REQUEST**

*NISAM NIŠTA UČINIO U VEZI S TIM, AL INECU RESPOND-OVATI EXPLICITNO DA JE TAJ PORT ZATVOREN*

**reject** KAŽE, "HEJ, OVAJ PORT JE CLOSED, I ON ŠALJE PACKET NAZAD NA SERVER

RAZLIKA JE PONEKAD ŠTO ŽELITE DA BUDETE EKSPLICITNI KADA GOVORITE LJUDIMA DA JE PORT ZATVOREN, ILI NEŠTO NALIK NA  "KORISTITE POGREŠAN PORT" ILI "POKUŠAVATE DA PRISTUPITE POGREŠNOM SERVERU"; ŽELITE BITI GOOD CITIZEN LJUDIMA KOJI POKUŠAVAJU DA KORISTE VAŠU USLUGU

DRUGI PUT IH ŽELITE BLACK HOLE-OVATI I NE DOPUŠTATE IM DA IM SE KAZE ŠTA SE DOGAĐA. ZELITE DA NE ZNAJU DA LI JE TAJ PORT OTVOREN ILI JE SAMO POTREBNO DUGO VREMENA DA SE RESPOND-UJE ILI NEŠTO SLIČNO

GENERALNO UVEK ŽELITE DA BLACK HOLE REQUESTS, OSIM AKO NEMATE ODREĐENI SLUČAJ KADA ŽELITE DA KAŽETE LJUDIMA DA USLUGA KOJOJ POKUŠAVATE DA PRISTUPITE NIJE ISPRAVNA ILI SU PARAMETRI INVALIDNI ILI SOMETHING LIKE THAT

DOSTA POPUT PRIMER KOJI SMO DALI RANIJE KADA POKUŠAVAMO DA PINGUJEMO NA NEK IDOMEN I ON SAMO HANG-UJE I HANGUJE

TO JE DOBAR NAČIN, REĆI ĆU USPORAVANJA NAPADAČA. NE ŽELIM DA KAŽEM DA DENYINGA NAPDACA JER THEY'LL GET AROUND THAT 

ALI TO JE DOBAR NAČIN EATING-A, NJEGOVIH RESURSA, JER SVAKI PUT KADA SE POKUŠAJU POVEZATI S USLUGOM KOJA IH SAMO BLACK HOLE-UJE, ONA SAMO HANG-UJE I HANG-UJE I JEDE NJIHOVE RAČUNARSKE RESURSE, NEKAKO USPORAVA CRWLING NJIHOVIH PORTOVA

VERSUS *reject*-A, KOJI IZRIČITO KAŽE DA VAM TO NIJE DOZVOLJENO

## ufw JE INSTALIRAN, ALI MOZDA SE NE POKRECE, I ZELIM TO DA PROVERIM SLEDECOM KOMADOM

- sudo ufw status

NEAKTIVAN JE, PA CU GA ENABLE-OVATI, *STO MOZE PREKINUTI MOJU SSH KONEKCIJU*

- sudo ufw enable

WE ARE GOOD NOW

******

:heavy_exclamation_mark:

RECI ĆU PONOVO, *KADA POČNETE ULAZITE U OBLASI KAO STO SU SECURITY, IP TABELE I ROUTING*:

:heavy_exclamation_mark::heavy_exclamation_mark::heavy_exclamation_mark::heavy_exclamation_mark: **ufw** *JESTE MALO LAKŠI* **ALI MOŽETE SE APSOLUTNO LOCK YOURSELF OUT OF THE SERVER** :heavy_exclamation_mark: :heavy_exclamation_mark::heavy_exclamation_mark: :heavy_exclamation_mark:

*AKO ZATVORIM PORT 22, KOJI JE MOJ SSH PORT, U TOM TRENUTKU NEĆU MOĆI DA UĐEM NA SERVER I ZAKLJUČAN SAM, ZATO BUDITE VRLO OPREZNI.* 

ufw JE U REDU, VEROVATNO NEĆETE UČINITI NEŠTO PREVIŠE LOŠE, ALI AKO POČNETE DA ODBIJATE SSH ZAHTEVE ILI IH BLACK HOLE-UJETE, YOU'LL BE IN A WORLD OF HURT, JER NEMA NAČINA DA UĐETE U TAJ SERVER JER JE PORT JE ZATVOREN, NEGDE JE BUKVALNO ZAKLJUČAN

:heavy_exclamation_mark:

******

DOZVOLILI SMO SSH, TAKO DA SMO U REDU

******

:heavy_exclamation_mark::heavy_exclamation_mark::heavy_exclamation_mark::heavy_exclamation_mark:

ALI NIJE U REDU JER SAM URADIO ONO CEGA SAM SE PRIBOJAVAO, :heavy_exclamation_mark::heavy_exclamation_mark: **ZAKLJUCAO SAM SEBE OUT OF THE SERVER** :heavy_exclamation_mark::heavy_exclamation_mark: (A TAKODJE I WEBSITE HANG-UJE)

POKUSAJ DA SE KONEKTUJEM BACK NIJE USPEO

*NA SRECU NA DIGITAL OCEAN-U U OKVIRU DROPLETA JA MOGU UCI NAZAD, ODNOSNO MOGU A **LAUNCH-UJEM CONSOLE*** (Access  --> Launc Cnsole)

MOGU SE ULOGOVATI KAO ZELENI USER, UPISATI MOJ PASSWORD

**DA TOGA NIJE BILO NE BIH MOGAO PONOVO NAZAD PRISTUPITI MOM SERVERU**

******

POKRENUCU PONOVO ufw STATUS, OVOG PUTA ZI CONSOLE-A DIGITAL OCENA, JER SAM LOCKOVAO MYSELF OUT 

- sudo ufw status

SADA PISE DA JE AKTIVNA

DA NADJEM NESTO STO CE MI DATI VISE INFORMACIJA

- man ufw

MOGU KORITII verbose KOMANDU UZ ufw status

- sudo ufw status verbose

IZ OUTPUT-A VIDIM DA NISTA NIJE ALLOWED, DAKLE, PORED OSTALOG LOCK-OVAO SAM SEBE COMPLETELLY, I SADA TREBA DA ALLOW-UJEM SSH

- sudo ufw allow ssh

MOZES OPET PROVERITI STATUS

- sudo ufw status verbose

I SADA MOGU VIDETI OVO U OUTPUT-U

```linux
To                         Action      From
--                         ------      ----
22/tcp                     ALLOW IN    Anywhere
22/tcp (v6)                ALLOW IN    Anywhere (v6)
```

MOGU SADA DA IZADJEM IZ KONZOLE KOJE JE PROVIDED BY DIGITAL OCEAN

POKUSAJ DA SE ULOGUJES NAZAD NA SERVER, ALI U TVOM GRIT BASH-U, KORISCENJEM SSH-A

I OPET SAM NAZADA NA SERVERU

**DAKLE DA DODAM SLEDECE**

JEM YOUNG JE POMISLIO DA NECU PO DEFAULTU POSTATI BLOKIRAN SSH PORT

ALI, KAO STO SAM VIDEO PORT 22 CE BITI BLOKIRAN, I JA CU BITI IZBACEN

MOZDA DA SAM BRZE allow-OVAO SSH PORT, MOZDA NE BI BIO IZBACEN

## SADA ŽELIMO DA OMOGUĆIMO JOŠ NEKOLIKO STVARI

USTVARI KADA ODES NA SVOJ SITE VIDECES "This site can’t be reached"

TO JE ZATO STO JE LOCKED I PORT ZA HTTP

- sudo ufw allow http

I RELOAD-UJ STRASNICU, I VIDECES ONOS TO SI SERVIRAO KORISCENJEM EXPRESS-A

POGLEDAJ OPET STATUS FIREWALL-A

- sudo ufw status

```linux
To                         Action      From
--                         ------      ----
22/tcp                     ALLOW IN    Anywhere
80/tcp                     ALLOW IN    Anywhere
22/tcp (v6)                ALLOW IN    Anywhere (v6)
80/tcp (v6)                ALLOW IN    Anywhere (v6)
```

I PORT 80 JE SADA ALLOWED

## OVO JE DAKLE MNOGO, MNOGO, MNOGO PRIJATNIJA SINTAKSA OD IP TABELA

NE ZNAM DA LI JE IKO OD VAS IKADA RADIO BILO ŠTA SA IP TABELAMA, ALI ONE NISU FRIENDLY AT ALL, I IMAJU SMISLA TEK ONDA KADA NEKAKO SHVATITE SINTAKSU I ŠTA SE DEŠAVA

ALI ***ufw* JE SAMO NICE AND CLEA NWRAPPER AROUND IP TABLE-OVA**

## NEKO JE JEM-U, TOKOM OVE SEKCIJE REKAO SLEDECE

>> DA LI ĆEMO DOZVOLITI HTTPS, A ZATIM KORISTITI NGINX DA REDIRECT-UJEMO SAV HTTP SAOBRAĆAJ NA HTTPS?

>>>> DA, NA EVENTUALLY ĆEMO OTVORITI HTTPS PORT, DAKLE, TO JE PORT 443, KADA UKLJUČIMO HTTPS.

A TO ĆE U RADTI MALO KASNIJE 

A SADA MALA VEZBA

### KAKOB KREIRAO ufw PRAVILO, KAK OBI BLOKIRAO SVE HTTP KONEKCIJE

- sudo ufw reject http

I ZATO SE ZOVE NEKOMPLIKOVANI FIREVALL. JEDNOSTAVNO SIMPLIFIES FIREWALL-A I OLAKŠAVA RAZUMEVANJE ŠTA SE DOGAĐA

