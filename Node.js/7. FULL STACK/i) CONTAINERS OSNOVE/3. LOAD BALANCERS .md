# LOAD BALANCERS

U REDU, RAZGOVARALI SMO O KONTEJNERIMA I ORKESTRACIJI I ELASTIČNOM CLOUD COMPUTING-U

ŠTA JE ELASTIČNO RAČUNANJE U CLOUDU

EXPAND-UJE SE I CONTRACT-UJE (SHRINK-UJE) SE NA OSNOVU VAŠIH POTREBA TOKOM VREMENA

TAČNO, I TO JE KORISNO ZA, MISLIM DA JE PRIMER KOJI SAM DAO, A KOJ ISE TICE NETFLIX-OVOG STREAMING-A, KOJE JE ZA VREME PRAZNIKA BILO A LOT OF IT

ISTO TAKO U PONOĆ MOŽDA NEĆE PUNO LJUDI GLEDATI PA MOZE SE TAKE DOWN-OVATI DEO RESURSA. A TOKOM DANA, KADA VIŠE LJUDI GLEDA, BRING-UJU RESURSE BACK UP

ALI TO RADIMO SA KONCEPTOM SAZNANJA O LOAD-A SERVERA, A ZATIM MERENJA I KAZIVANJA "HEJ, OVA STVAR JE NA 90% LOAD-A. MORAMO USMERITI SAOBRAĆAJ NEGDE DRUGDE."" ILI SMO 10% OPTEREĆENI, "ZAPRAVO NAM NE TREBAJU OVI SERVERI". ALI **LOAD BALANCER JE ONO ŠTO ROUTE-UJE SAV TRAFFIC U ODGOVARAJUĆI CLUSTER.**

I TO JE NEŠTO O ČEMU NE RAZMIŠLJATE DOK NISTE AT A SCALE, ČAK NE RAZMISLJATE O TOME KADA IMATE DVA SERVERA.

ALI CU UZET DVA SERVERA ZA PRIMER. JEDAN SERVER MOŽE DOBITI SAV TRAFFIC, JER JE TO SAMO NAČIN NA KOJI SE SAOBRAĆAJ ROUT-UJE. A ONDA DRUGI SERVER, TO JEDNOSTAVNO NE RADI NIŠTA, VEC SAMO WASTE-UJE CIKLUSE. 

A PROBLEM SA RUNNING-OM 90% LOAD-A JE U TOME ŠTO JE MALO SPORO

DOK DRUGI SERVER NE RADI NIŠTA. TU DOLAZI KONCEPT LOAD BALANCER-A. OSIGURAVA DA JE SAOBRAĆAJ RAVNOMERNO PODELJEN IZMEĐU SVIH VAŠIH SERVERA. JER NEMA VEZE DA LI IMATE 10.000 SERVERA, AKO TRI SERVER-A RADE SAV POSAO, OSTALI NE RADE NIŠTA.

# LOAD BALANCERS RADE SA KONCEPTOM KOJI SE ZOVE **SCHEDULING ALGORYTHM**

ZNAM, OVO ZVUČI DOSADNO, ALI TO SU, PO MENI, NEKI OD NAJZANIMLJIVIJIH DELOVA. 

U REDU, ŠTA MISLITE DA RADE NEKI OD OVIH SCHEDULING ALGORYTHMS? NEKAKO SU U IMENU. 

>> IP HASHING JE MALO ŠKAKLJIV

DAKLE, ZAMISLITE DA STE IMALI DESET SERVERA I DA IMATE REQUEST COMMING IN. 

KAKO LOAD BALANCER ODREĐUJE NA KOJI SERVER IDE?

TO RADI SCHEDULING ALGORYTHM

DAKLE, ŠTA MISLIŠ DA **ROUND ROBIN** ALGORITAM RADI RADI?

PRELAZI NA SLEDEĆI U NIZU.

TAČNO, TAČNO JE TO, TO JE DEFAULT STRATEGIJA BALANSIRANJA LOAD-A ZA VEĆINU BALANSIČARA LOAD-A.

TU JE I IP HASHING,

**KOJI HASH-UJE VAŠ IP. TO ZNAČI DA GA RUNN-UJE KROZ HASHING ALGORITAM, PRETVARA GA U SKUP ZNAKOVA, A ZATIM USPOREĐUJE SA DRUGIM SETOM IP-OVA. PREDNOST IP HASHING-A JE U TOME ŠTO VAM JE ZAGARANTOVANO DA IDETE NA ISTI SERVER SVAKI PUT NA OSNOVU VAŠE IP ADRESE.**

POSTOJI I **JUST RANDOM**

I ONO ŠTO JE SMIJEŠNO JE DA SMO POTROŠILI PUNO VREMENA I ISTRAŽIVALI SCHEDULING ALGORYTHM-E. ALI RANDOM CHOICE ZAPRAVO DELUJE PRILIČNO DOBRO, SAMO ODABIR RANDOM SERVERA FUNKCIONIŠE U REDU. NIJE DEFAULT, ALI ZAPRAVO NIJE LOŠA STRATEGIJA. 

POSTOJI I **LEAST CONNECTIONS**

TO ZNAČI DA LOAD BALANCER MORA ZNATI KOLIKI JE LOAD NA SVAKOM POJEDINOM SERVERU I TO KAŽE NA PRIMER "OVAJ SERVER IMA 20 KONEKCIJA, A OVAJ 10, IDEM DO ONE KOJA IMA 10"

TU JE I KONCEPT LOAD-A. DAKLE, AKO IMATE ZAISTA PROCESS INTENSIVE APLIKACIJE, SERVER SA NAJMANJE KOLIČINE LOAD-A DOBIĆE VIŠE TRAFFIC-A DOK SE BALNC-UJE BACK

I KAO ŠTO REKOH, ROUND ROBIN JE ZADATA POSTAVKA ZA VEĆINU LOAD BALANCER-A

## POMENUO SAM DAKLE SLEDECE SCHEDULING ALGORITME

- Round Robin (DEFAULT)

- IP Hashing

- Random Choice

- Least Connections

- Least Load

## DAKLE, POGLEDAJMO KOLIKI JE LOADING NAŠEG SERVERA TRENUTNO

POKRENIMO **top**

- top

OVO NAM OMOGUĆAVA REAL TIME UVID O ONOME ŠTO SE DEŠAVA NA NAŠEM SERVERU

TO NAM GOVORI KOLIKO IMAMO AVAILABLE THREADS, ŠTO ĆE VEROVATNO BITI JEDAN THREAD, JER IMAMO SAMO JEDAN CPU

KOLIKO RAM-A IMA

IT'S REALTIME AND IT'S ALWAYS KEEPING TRACK 

**NE ŽELITE STALNO DA POKRECETE *top***, *JER SAM top ZAHTEVA RESURSE  DA BI SE POKRENUO. A NA NAŠEM JEDNOM MALOM SERVERU, **AKO STALNO BUDETE NA top-U, VIDELI BISTE DA POTROŠNJA RESURSA RASTE.***

ALI ISKRENO, OVO NIJE TAKO USER FRIENDLY

JEM COULD BREAK IT DOWN. MOGAO BI ON NAPISATI SCRIPT KOJI IZVLAČI SVE ONO ŠTO MI OVO DETALJNO GOVORI. ALI INSTALIRAJMO NEŠTO MALO ČISTIJE. INSTALIRAJMO **htop** I ODUSTAJMO OD top-A

## INSTALIRAJMO **htop**, ŠTO JE MALO LJEPŠE

- sudo apt install htop

MISLIM DA JE ZAPRAVO VEĆ BILO INSTALIRANO

HAJDE DA POKRENEMO htop SADA.

- htop

TO JE MNOGO COOL

*OVO JE JEDNA OD ONIH STVARI KOJE MOŽETE OSTAVITI NA RAČUNARU I LJUDI ĆE PROŠETATI PORED VAS, I BICE KAO "NA ČEMU ON RADI? MORA DA JE STVARNO PAMETAN, POGLEDAJTE SVE TE BROJEVE!"

ALI STVARNO TO JE ISTA STVAR KAO I top, SAMO JE U LEPŠEM FORMATU. I GOVORI NAM O

- OPTEREĆENJU CPU-A (CPU LOAD), NAŠOJ POTROŠNJI MEMORIJE (MEMORY CONSUMPTION)

SMEŠNO, AKO POGLEDAMO ŠTA KORISTI ČITAV CPU, htop JE NA VRHU POTROSNJE.

DA BI SE OVO POKRENULO, KORISTI SE MNOGO CPU-A.

*AKO PRITISNES TASTER `t`* MOZES UCI U *tree MODE*

SEĆATE SE DA SAM REKAO DA PM2 MOŽE POMOĆI U CLUSTERING-U?

CITANJEM OVIH PODATAKA JEM JE ZAKLUCIO:

ZAPRAVO ĆE pm2 SPIN UP-OVATI VIŠE INSTANCI VASE NODE APLIKACIJE FOR YOU I ADDS THEM AND SUBSTRACTS THEM ZA VAS

MOŽEMO VIDJETI DA OVDJE PM2 POKREĆE NODE, ALI POKREĆE I SVE OVE RAZLIČITE INSTANCE NODE-A I POSTOJE SVE OVE RAZLIČITE INSTANCE pm2-A

DAKLE, TO JE SAMO tree MODE

ALI, STVARNO, AKO JE VAŠ SISTEM POKRENUT SPORO, RUNNING top ILI htop JE DOBRA STVAR TO PULL UP I VIDITE ŠTA TAČNO TROŠI SVE MOJE CPU CIKLUSE? 

MAC EKVIVALENT BI BIO, RECIMO, *activityMonitor* (PREDPOSTAVLJAM DA JE OVO ISTO KA OTASKA MANGER NA WINDOWS-U)

I MOGU POKRENUTI MONITOR AKTIVNOSTI ZA SVOJ MAC U MNOGO ČIŠĆEM UI-U

I MOŽEMO VIDETI DA JE activityMonitor ZAPRAVO ONAJ KOJI KORISTI SAV MOJ CPU, ALI GENERALNO ĆE CHROME BITI GLAVNI KRIVAC ILI VS CODE

top JE DAKLE SAMO DOBRA STVAR DA ZNATE YOUR LOAD. I TAKO, KADA GOVORIMO O LOAD BALANCERIMA, TO JE ONO O ČEMU GOVORIMO, RAZUMEVANJE CPU-A LOAD-A, CONNECTION LOAD-A, MEMORY LOAD-A.

I DA ODUSTANEM, MOGU SAMO CTRL + C, MISLIM, ILI F10.

KOJI SU KODOVI BOJA U ODELJKU MEMORIJE, ZNATE LI (PITAO GA NEKO IZ PROSTORIJE) (TO CES VIDETI N ASAMOM VRHU LEVO; O TOME PRICAJU)

>> JEM IOUNG: ŽELIM REĆI DA BI CRVENA BILA LOŠA, ALI PONEKAD TO PREĐE U CRVENO, ŠTO NE ZNAM ŠTA TO ZNAČI.

[00:06:37] MOŽDA ZNAČI DA SE CPU KORISTI ILI NE. AKO NEKO ZNA, MOŽE MI GA TWEET-OVATI

## RANIJE SAM REKAO DA JE NGINK JACK-OF-ALL-TRADE. PA, ZNAŠ ŠTA? NGINK MOŽEMO KORISTITI I KAO LOAD BALANCER-A, TO JE BAŠ TAKO COOL

OVDE MOZES NESTO VISE PROCITATI O IMPLEMENTACIJI LOAD BALANCER-A SA Nginx-OM: <https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/>

NEĆEMO GA DANAS IMPLEMENTIRATI JER IMAMO SAMO JEDAN SERVER, TAKO DA ZAISTA NEMA ŠTA DA SE URAVNOTEŽI. ALI AKO BISMO IMALI DVA SERVERA ILI TRI SERVERA, DODAJEM OVAJ upstream backend BLOL:

```linux
upstream backend {
  server backendl.example.com;
  server backend2.example.com;
  server 192.0.0.1 backup;
}

server {
  location /{

    proxy pass http://backend;
  }

}
```

A ZATIM proxy_pass SVE CONNECTIONS NA JEDNU

**DAKLE, ONO ŠTO MOŽEMO JE DA MOŽEMO POKRENUTI NODE APLIKACIJU NA RAZLIČITIM SERVERIMA ILI RAZLIČITIM KLASTERIMA**

A ONDA AKO PROKI_PASS DO JEDNOG OD NJIH, I NGINK ODLUČI NA OSNOVU STRATEGIJE KOJU KORISTIMO, WHICH SERVER TO GO TO.

TO JE PRILIČNO LEPO. DAKLE, OUT OF THE BOX, VEROVATNO BIH MOGAO DA POKRENEM 1.000 SERVERA SA JEDNIM NGINK LOAD BALANCEROM I TO ĆE SAVRŠENO PODNIJETI TRAFFIC.

**MOŽETE POSTAVITI STRATEGIJU upstream backend, AKO IKADA BUDETE IMALI HIGH RESOURCE INTENSIVE SERVICE**

```linux
upstream backend {
  least_conn;
  
  server backendl.example.com;
  server backend2.example.com;
}

```

MOŽEMO REĆI least_con 

TO SAMO ZNAČI DA ĆEMO KORISTITI LEAST CONNECTION SERVICE. ŠTO JE FENOMENALNO ŠTO NGINK OVO RADI ZA VAS. JER SE AUTOMATSKI KONEKTUJE NA SERVER, DOBIJA LOAD, REPORTS BACK SVAKIH, NE ZNAM, PAR MILISEKUNDI ILI TAKO NEŠTO, I IZVEŠTAVA KOLIKO KONEKCIJA IMATE SVAKI PUT.

MOŽEMO RADITI I  ROUND ROBIN. MOGLI BISMO DA URADIMO IP HASHING, TAKVE STVARI.

NE ZNAM DA LI SAM GOVORIO O **STICKY SESSIONS-IMA**. ISKRENO, VOLIM NGINK, ODLIČAN JE SOFTVER. SVE TO RADI ZA VAS. BUKVALNO MOGU POKRENUTI ČITAVE VEB APLIKACIJE SA STOTINAMA SERVERA SAMO UZ NGINK I TO BI RADILO BEZ PROBLEMA.

## STICKY SESSIONS

ALI EVO PITANJA ZA VAS: *ŠTA JE SA SESSION DATA*?

> PA, ŠTA AKO SE LOG IN-UJEM NA SERVER, NA OVOM, JEDNOM SERVERU SAM AUTHORIZED

> KAKO DA ZNAM DA NEĆU BITI ROUTED NA DRUGI SERVER NA KOME NISAM LOGGED IN?

> I TO JE PRAVI PROBLEM NA KOJI JEM NAILAZI.

> SAD JE TO UGLAVNOM REŠENO, ALI ŠTA MISLITE ŠTA BI SE TAMO DOGODILO?

PA, ZAVISI OD TOGA DA LI KORISTITE STICKY SESSIONS

ŠTA JE STICKY SESSIONS?

STICKS-UJE VAS NA ODREĐENI SERVER DA NE BITE BILI BUMPED BETWEEN THEM

TAČNO, O TOME NE RAZMIŠLJAMO SVE DOK NE BUDETE MORALI DA IMPLEMENTIRATE NEKU VRSTU LOGIN-A ILI AUTHORIZATION FUNCTION-A

MOZES BITI KAO BUDI KAO "DA, WE'LL THROW LOAD BALANCER, WE'LL SPIN UP 20 SERVERA, I DOBRO SAM."

ALI TADA SAM PRIJAVLJEN, ALI HITT-UJEM LINK ILI OSVJEŽIM STRANICU I VIŠE NISAM PRIJAVLJEN. TO JE FRUSTRIRAJUĆE, JER ME LOAD BALANCER MOŽE SVAKI PUT ROUTE-OVATI NA DRUGI SERVER.

**NAČINI REŠENJA TOGA BI BILO HASHING IP-A**. DAKLE, TO ZNAČI DA KADA HASH-UJEM IP, UVEK ĆU IĆI NA ISTI SERVER SVAKI PUT. DRUGI NAČIN BI BIO SAMO PROVOĐENJE *AUTHORIZATION LAYER* PRIJE NEGO ŠTO ČAK I HITT-UJEMO NA NGINK. TAKO SE SAMO OSIGURAVA DA SAM U POTPUNOSTI AUTHORIZED. AKO NISAM, SAMO ME BOUNCE-UJE OFF

AKO SAM AUTHORIZED, IDE SAMO NA SERVER I NEMA VEZE DA LI SAM GA LOGGED IN ILI NE, JER WE KNO WE PASSED TO THAT FIREVALL.

KADA RAZMIŠLJAMO O TOME, NE MOŽEMO SAMO SLEPO IMPLEMENTIRATI STVARI. KOLIKO GOD OLAKSAVA Nginx, TO SU PITANJA KOJA MORAMO UZETI U OBZIR.
