# PROCESS MANAGER

JA I DALJE IMAM PROBLEM, A KOJI SE TICE MORANJA DA STALNO STARTUJEM NODE APPLIKACIJU MANUELNO

PRITISNEM CTRL + C I JA SAM IZASAO IZ NODE-A PROCESS-A, ODNSNO ON JE KILLED ONDA, I TO SAM RADIO SVAKI PUT KADA BIH TREBAO DA URADIM NESTO DODATNO NA SERVERU, DA PROCITAM NEKI FAJL, A KAD KRENEM NA SPAVANJE OBAVEZNO KILL-UJEM NODE PROCESS, I MOJA APLLIKACIJA VISE NE RADI

STA AKO MOJ RACUNAR GOES TO SLEEP ISTO TADA JE MOJA APPLIKACIJA KILLED

KADA EXIT-UJEM IS SHELL-A TO, KILL-UJE SVAKI PROGRAM

_DAKLE TREBA MI NEKI MANAGER_

## ONO STA MI TREBA JE **`PROCESS MANAGER`**

- PROCESS MANGER JE SAMO WAY OF KEEPING YOUR APPLICATIO UP AND RUNNING

- ON HANDLE-UJE ERRORS I RESTARTS

AKO IMAM MESTO U CODE-U, KOJE THROW-UJE UNHANDLED EXCEPTION. TO CE U NODE-U KILLOVATI PROGRAM, **TREBA TI NEKI SERVICE, KOJI HANDLE-UJE TO I RESTART-UJE GRACEFULLY; NJEGOV JOB JE DA KEEP-UJE PROCESS UP AND RUNNING, KONSTANTNO, A TO TREBA DA RADI U BACKGROUND-U**

- MOZE HANDLEOVATI LOGGING I CLUSTERING

## JA CU SADA KORISTITI **pm2** PROCESS MANGER-A

<https://pm2.keymetrics.io/>

ONO STA JOS MOZES KORISTITI JESTE PROGRAM KOJI SE ZOVE [FOREVER](https://www.npmjs.com/package/forever) (JEM KAZE DA JE OVAJ PROGRAM DOBAR)

OVAJ PAKET INSTALIRAM GLOBALNO NA MOM UBUNTU SERVERU (_KADA GLOBALNO INSTALIRAS MORAS KORISTITI sudo KOMANDU_ (INACE JE RULE OF THUBS DA SE IZBEGAVA GLOBALNO INSTALIRANJE, ALI OVO JE IZUZETAK GDE TREBA))

> > If you wanna run things globally but from the local directory you can use something called [npx](https://www.npmjs.com/package/npx). Which will look at first in your local and then move up. But in this case, we wanna run globally because its a process manager.

- sudo npm i -g pm2

PM2 JE NESTO VISE FULL FEATURED NEGO OVAJ DRUGI KOJI SAM POMENUO, I ON JE A LITTLE BIT CLEANER TO USE (AL ITI AKO HOCES MOZES DA KORISTIS BILO KOJI)

---

digresija:

JA SAM, RANIJE VERZIJU NODE-A INSTALIRAO IZ apt REPOZITORIJUMA (PISAO SAM `sudo apt install nodejs npm`) ONI SU UVEK BEHIND, ALI U DRUGO MDELU WORKSHOPA, KORISTICU NOVU VERZIJU NODE-A, SA NOVIM FETURE-IMA, A ZA SADA MI JE DOVOLJNA BASLINE VERZIJA

JA CU U DRUGOM DELU WORKSHOPA RUNN-OVASI NODE 10 ILI 12, SVE ZAVISI KOJA IMAM VERZIJU LTS (UBUNTU-A)

PREDPOSTAVLJAM DA CU ONDA nvm KORISTITI ZA POINTING TO THE DIFFERENT VERSION

DAKEL TO CU RADITI U DRUGOM DELU WORKSHOP-A

---

## STARTOVACU SADA pm2

---

digresija:

KADA SE ULOGUJES TI SI UVEK U

_`/home/$USERNAME/`_

A TU TAKODJE STIZES I SA **`cd ~`**

**APLIKACIJU SI STAVIO U SLEDICI DIREKTORIJUM (RECI CU KOJI JE TO U ODNSU NA POMENUTU ~)**

_`cd ../../var/www`_

TU TI JE app FOLDER, SA TVOJOM APLIKACIJOM

---

DAKEL STARTUJEM pm2 (UMESTO node KOMANDE)

- **pm2 start app.js**

NE ZABORAVI 'start' ,GORE

## DAKLE RUNN-OVAO SAM pm2

VIDECU ZANIMLJIV OUTPUT U TERMINALU, KAO POSLEDICA RUNNING-A TOGA

TU JE I JEDNA TABELA

ONA MI POKAZUJE IZMEDJU OSTALOG I OVO

DA app RUNN-UJE SA ID-JEM NULA (0), JER JE TO ONLY THING THAT IS RUNNING NOW

MENI JE SADA SLOBODNO KUCANJE U TERMINALU, ODNSNO NODE APP RADI IN BACKGROUND I JA MOGU GO OR DO WHAT EVER I WANT

> > If it crashes it's going to do its absolute best to keep it up, just in case.

MEDJUTIM NISAM OVDE ZAVRSIO STVARI

SAD AKO OSE RESTARTUJE SERVER, MORAO BIH OPET KUCATI np2 start KOMANDU, KAK OSAM GORE POKAZAO

## ZATO MORAM MODIFIKOVATI np2-OV startup FILE (ALI POSTOJI MOGUCNOST DA JE OVO AUTOMATSKI URADJENO)

TO RADIM KAKO BI OMOGUCIO DA SE SE KREIRA DAEMON, KOJI CE UVEK START-OVATI MOJU APLIKACIJU, KADA STARTUJEM SERVER

KUCAM SADA KOMANDU (MOZDA BI BIL ODOBRO DA SI U app FOLDERU KADA KUCAS OVU KOMANDU)

- **pm2 startup**

OVA KOMADA CE USTVARI OUTPUTOVATI, CELU DRUGU KOMANDU KOJU TREBAM DA RUNN-UJEM

JEM JE CITAJUCI JE ZAKLJUCIO DA MOZDA NE TREBA DA JE RUN-UJE, ZATO STO KAO STO JE REKAO 'pm2, IT DOES TART IT FOR ME AUTOMATICALLY'

ALI CU IPAK PROVERITI

DA BIH PROVERIO

UGASICU SERVER PA CU GA PONOVO UPALITI

## ODNOSNO I'M GOING TO TAKE DOWN MY SERVER

IDEM U DIGITAL OCEAN, KLIKNI TAMO NA TVOJ, PROJEKAT, PA NA DROPLET (USTVARI KLIKNI NA IME SERVERA U DROPLET ELEMENTU (PRVI NAZIV PRE IP-JA (IP JE U SREDINI)))

SADA CES IMATI U DESNOM COSKU **on/off** SWITCH

SACEKAJ DA SE UGASI

PA GA ONDA UPALI

KADA SAM GA UPALIO VIDEO SAM DA OVO NIJE PROSLO, ODNONO APP NE RADI, I TO SAM MOGAO VIDETI ODLASKOM NA MOJ WEBPAGE U BROWSERU (IMAM `502 Bad Geteway`)

## DAKLE NIJE USPELO, I ZATO SAD ULOGUJ SE OPET U SERVER I POGLEDAJ STATUS pma2

- pm2 status

U OUTPUTED TABELI MOZES VIDETI DA TI APP NE RUNN-UJE

STARTUJ OPET APP (PRVO NAVIGATE TO app DIRECTORI, ILI NAPISI PATH)

- pm2 start app.js

OUTPUTUJ STARTUP KOMANDU

- pm2 startup

KOPIRAJ OUTPUTED KOMANDU IZ TERMINALA

- EXECUTE-UJ JE

SAVEUJ pm2

- pm2 save

PISE DA JE SUCCESSFULLY SAVE

SUPER SADA JE SACUVANO

SADA KADA SERVER RESTARTS pm2 WILL GET UP AND RUNNING

> > This is actually a pretty big deal cuz you'll forget to do it and you will kill your server

## SADA AKO OPET TURN-UJES OFF DROPLET , I AKO OPET TURN-UJES ON TVOJ APP CE RADITI

MEDJUTIM EVO STA SAM PROCITA KADA TAMO NA DIGITAL OCEAN-OVOJ STRANICI TURN-UJEM OFF DROPLET

```linux
When you turn off a Droplet from the control panel, we first try a graceful shutdown. If that fails, we do a forced shutdown,
which may corrupt data. To ensure data integrity, we recommend shutting down from the command line with

- poweroff

When a Droplet is off:

Its data and IP address are retained and its disk, CPU and RAM are reserved.
You continue to accrue its data transfer allowance.

Warning: You will still be billed for a turned off Droplet. To end billing, destroy the Droplet instead
```

O OVOM POSLEDNJEM REDU GORE, IMAO DA KAZE NESTO I AUTOR WORKSHOPA

> > Digital Ocean will tell you this, you're still getting billed.

UPRKSOS STO TURN-UJES OFF, NE ZNACI DA SI SE DELOCATE-OVAO, TO SAM OZNACI DA IT'S NOT RUNNING; I TO JE VAZNA DISTINGCIJA, ZATO STO JE MOZES ISKLUCITI I POMISLITI, MEN INE TREBA SERVER, ALI ONI TI I DALJE NAPLACUJU, TAK ODA TVOJ MILAGE MAY VARY

DAKLE AKO HOCES DA UGASIS VPS I DA NE BUDES VISE BILLED, MORAS DESTORY-OVATI DROPLET

## VIDEO SAM DA pm2 MOZE IMATI I WATCH MODE

PROVERI KAK OTO FUNKCIONISE

PREDPOSTAVLJAM DA TO ZNACI DA NE MORAM RELOAD-OVATI pm2 NAKON PULLINGA PRODUCTION CODE-A, ODNOSNO ONOG NODE PROCESS-A KOJEG EXECUTE-UJEM SA PROCESSA MANGER-OM
