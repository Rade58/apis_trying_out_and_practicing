# ZELIM DA DEFINISEM GOTOVO ISTI PRIMER KOJI JE AUTOR WORKSHOPA DEFINISAO, SAMO STO ZELIM DA, STO SE TICE NODE APLIKACIJE, JA NJU SERVIRAM SA RAZLICITOG PORT-A, KAKO BI BILE DOSTUPNE DVE APLIKACIJE; JEDNA JNA JEDNOM A JEDNA NA DRUGOM PORTU

******

digresija **ALI VAZNA**:

SLEDECOJ VEZBI JA HOCU DEFINISATI DA SE STATICNI FAJLOVI, ZAJENO SA HTML STRANICOM SERVIRAJU IZ EXPRESS-A

**TO JE IZUZETNO LOSA PRAKSA** (*ALI MISLIM DA JE TO SAMO SLUCAJ KOD LARGE APLIKACIJA*)

POGLEDAJ OVO (KONFIGURACIJA Nginx)

<https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/>

ALI PRONDAJI NESTO GDE CES SAZNATI VISE O OVOME

<https://hashnode.com/post/why-is-it-not-recommended-to-serve-static-files-from-nodejs-ciibz8flv01duj3xt4lxuomp3>

MOZDA IMAM NESTO BOLJE OBJASNJENO OD PREDHODNOG LINKA, ALI NAKI TON BUDE POLAZNA TACKA

*ZA SADA U OVOJ VEZBI JA CU KORISTITI EXPRESS ZA SEVING HTML I STATIC FAJLOV-A*

MILIM DA JE U OVOM SLUCAJU proxy_pass KOJI SAM RANIJE DEFINISAO ZA /, UPRAVO PREUSMERIO NA 3000 SERVIRANJE HTML-A

MORACU JOS TO PROVERITI

******

******

DIGRESIJA DVA VEZANA ZA STATICNE FAJLOVE:

GOVORIM GENERALNO:

AKO CES VSITI CACHING STATICKIH FAJLOVA U BROWSERU, MOZDA NIJE NI BITNA PRICA DA LI IH DIREKTN OSERVIRA Nginx ILI POSREDSTVOM EXPRESS-A

******

**DA SE SADA VRATIM NA VEZBU**

JEDNA APLIKACIJA CE BITI ONA POSTOJECA (Hello World) (ALI CU JE IZMENITI DA SERVIRA STATICNE FAJLOVE I HTML)

ONA JE ZA PATH /

A DRUGA CE HANDLE-OVATI WEBSOCKET

ONA MOZE BITI ZA PATH /blahchat

## U PROSLOM MD FAJLU SAM OBJASNIO KAKO DA KONFIGURIRAM Nginx, KAKO BI MOGAO DA KORISTIM WEB SOCKET, ALI POSTO SAM TO URADIO ZA POSTOJECU LOKACIJU (PORT SA KOJEG SERV-EUJEM ), A TU MI NECE TREBATI WEBSOCKET, JA SADA ZELIM OPET DA KONFIGURIRAM Nginx, KAKO BI SVE POPRAVIO

ZA NOVI PATH CU ZADATI proxy_pass I OSTALA DVA UPGRADE-A, KOJA SE ODNOSE NA WEB SOCKET

- sudo vi /etc/nginx/sites-available/default

EVO '/' LOCATION CE BITI BEZ WEB SOCKET NADOGRADNJE

A '/blahchat' CE IMATI NADOGRADNJU ZA WEBSOCKET, A; A ZADAO SAM MU I proxy_pass; I ONO STO VIDIS JESTE DA CE SE KORITITI PORT 3800

```linux
location / {
        proxy_pass http://127.0.0.1:3000/;
}

location /blahchat {
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_pass http://127.0.0.1:3800/;
}
```

## DA REDEFINISEM SADA MOJ app.js FAJL, KAKO BI UCINO DA ON BUDE SERVER, SVIH STATICNIH FAJLOVA

PRVO DA TI KAZEM DA SE TVOJI STATICKI FAJLOVI U SLUCAJU TVOG PROJEKTA NALACE (ILI TREBA DA SE NALAZE ILI NE MORAJU, JER JE OVO SAMO VEZBA) U:

/var/www/app/ui/css
/var/www/app/ui/js

JER TAM OSAM DEFINISAO ui FOLDER

HTML FAJL TREBA DA SE NALAZI U (TAM OSAM GA POSTAVIO)

SVE CU URADITI LOKALNO, U REPO-U, KOJI SAM, AKO SE SECAS OD RANIJE ODAVNO KLONIRAO (TVOJI SSH KLJUCEVI SU PODESENI, AI GITHUB REPO SECAS SE (LOKALNO RADIS PUSH-UJES NA GITHUB, PA TO PULLUJES SA GITHUB-A NA SERVER))

app.js FAJL

```javascript
const express = require('express');
const app = express();

const port = 3000;

// OPET NE ZABORAVI NEKE STVARI

//      __dirname                       JE ABSIOLUTE PATH TRENUTNOG MODULA (NE MORA ZNACITI DA JE ABSOLUTE PATH EXECUTABLE; 
//                                                                              ON JE SAM OTO KADA SE KORISTI U EXECUTABLE-U)

// DA BIH SERVIRAO STATICNE FAJLOVE, KORISTIM       express.static      MIDDLEWARE

// CIM JE MIDDLEWARE, ZNACI DA GA KORISTIS SA                   use             METODOM

// path.join CE TI POMOCI DAKLE DA PRAVILNO SPOJIS PARCIJALNE PATHOVE, KAO STO SU __dirname (APSOLUTNI APATH) I NA PRIMER
//                                                                                           'RELATIVNE' PATH-OVE FPLDERA GDE 
//                                                                                             SU STATICKI FAJLOVI)


// KADA KORISTIM                        static  MIDDLEWARE   JA PROVIDE-UJEM SAMO PATH-OVE DO FOLDER-A U KOJIMA SU TI FAJLOVI

// However, the path that you provide to the express.static function is relative to the directory from where you launch your 
// node process. If you run the express app from another directory, itâ€™s safer to use the absolute path of the directory that 
// you want to serve ( https://expressjs.com/en/starter/static-files.html )

app.use('static', express.static(path.join(__dirname, '/ui/css')))
app.use('static', express.static(path.join(__dirname, '/ui/js')))

// GORNJI static CE BITI DEO VIRTUELNOG PATH-A (NEPOSTOJECEG)
// To create a virtual path prefix (where the path does not actually exist in the file system) for files that are served by 
// the express.static function, specify a mount path for the static directory

// static METODI TREBA PRAVI ABSOLUTE PATH, A use METODI SAM ZADAO (PRVI ARGUMENT) (TO JE DEO VIRTELNOG PATH-A, NEPOSTOJECEG
//                                                                                    TAKAV VIRTELNI PATH SE KORISTI U HTML-U)


// A SADA DEFINISEM SLANJE HTML

app.get('/', (req, res) => {
  // res.send('Hello World!');    OVO RANIJE NIJE SLUZILO NICEMU

  // A SADA CU DA DEFINISEM SLANJE               HTML-A
  // KORISTIM                     sendFile        METODU



});

///////// OVO NIJE BITNO (TO JE ONA VEZBA OD RANIJE ZA KOJ USI KREIRAO CUSTOM HEADER)/////////////

app.get('/blah', (req, res) => {

	res.set('X-bobby-the-trash-can', "you'we been bobied")

	res.status(418).json({message: "Hellow"})

})
/////////////////

app.listen(port, () => {
	console.log(`Example app listening on port ${port}!`)
})
```

******

**DILEMA**

DA LI CE static MIDDLEWARE INSERT-OVATI PATH-OVE, STATICNIH FAJLOVA (javascript-A I css-A) U HTML KOJI SERVIRAM

PREDLAZEM DA TO PROVERIS *TAK OSTO CES U POMENUTOM **css** FOLDERU SERVIRATI NEKI css* (KOJI CE PREFARBATI CELU POZADINU ZA POCETAK)

ALI MISLIM DA IPAK NECE:


MORACU SAM; JER EXPRESS CE 

******


## ONO KAKO CU SADA DEFINISATI JESTE DA CU SAMO DEFINISATI NOVI EXPRESS SERVER, ODNONO NOVI FAJL, PORED POSTOJECEG app.js

OVO DAKLE DEFINISEM VEZANO ZA BACKEND

LOKALNO CU CAK MOCI I TESTIRATI WEB SOCKET (PREDPOSTAVLJAM DA MOGU NAPRAVITI NEKI TAKAV SETTING, ALI MOZDA TO OVDE NECU URADITI)

NEKA SE NOVI FAJL ZOVE **/socket/socket.js** (NEKA SE socket FOLDER NALAZI PORED app FOLDERA, JER KAO STO SAM REKOA RANIJE NAJBOLJ JE DA OVAKO DELIM APLIKACIJE)

I ODMAH INSTALIRAJ 'ws' PAKET O KOJEM SAM GOVORIO

- npm i ws --save

A SADA OVO DEFINISEM U /socket/socket.js

```javascript

// GLEDACU DA PRETERANO NE 


```

