# WEBSOCKETS

MORAMO RAZUMJETI ŠTA JE WEBSOCKET.

MOŽETE DA GA KORISTITE FROM THE CLIENT ZA OTVARANJE LONGTERM KONEKCIJE I SAMO PUSH-UJETE MESSAGE-OVE BACK AND FORTH, CLIENT TO SERVER, SERVER TO CLIENT; ONA JE DVOSMERNA I MULTIPLEKSIRAN-A

ILI SKRACENO: *PERSISTANT BIDIRECTIONAL CONNECTION IZMEDJU CLIENT-A I SERVER-A*

TO JE TRAJNA DVOSMERNA VEZA IZMEĐU KLIJENTA I SERVERA

DAKLE, ZA RAZLIKU OD TRENUTNOG STATUSA QUO-A SA TCP-OM, ZA KOJE SVAKI SINGLE CONNECTION, ZAHTEVA POMINJANI HANDSHAKE. SA HANDEDOF-om WEB SOCKE USPOSTAVLJATE SAMO JEDNU VEZU I TO SE ODRŽAVA ŽIVIM KROZ TUNEL.

NA TAJ NAČIN KLIJENT MOŽE DA ŠALJE PODATKE, SERVER MOŽE DA ŠALJE PODATKE, I TO JE MNOGO BRŽE OD TCP VEZE, IAKO RADI PREKO TCP-A.

MORAL PRIČE JE DA LI JE WEBSOCKET JE, TA UPORNA KONEKCIJA DA MOŽEMO DA ŠALJEMO STREAMING DATA.

PUNO SE KORISTI U APLIKACIJAMA ZA ĆASKANJE KAO ŠTO JE TO GDE ZNATE DA ĆE KLIJENT NASTAVITI DA KOMUNICIRA SA SERVEROM.

PA ZAŠTO JEDNOSTAVNO NE BI DRŽALI TU VEZU OTVORENOM

ONO ŠTO SMO NEKADA RADILI BIO JE OVAJ KONCEPT OF LONG POOLING, KOJI JE BIO OTVOREN TCP VEZOM, I SAMO GA ODRŽAVAJ U ŽIVOTU I NASTAVLJAŠ PUSH-OVATI PODATKE BACK AND FOURTH

I NA TAJ NAČIN KLIJENT OSTAJE OTVOREN, SERVER OSTAJE OTVOREN. U REDU JE, ALI NIJE TAKO EFIKASAN KAO WEBSOCKETS

## ODVOJENO OD WORKSHOP ZELIM OVDE DA SE MALO BOLJE UPOZNAM SA WebSocket PROTOCOL-OM

ONO STA VIDIM DA JE DOBAR RESURS JESTE SLEDECE: <https://javascript.info/websocket>

A EVO GA MDN-OV PAGE GDE JE OBJASNJEN [WebSocket API](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API)

### ONO STO SE MOPRA URADITI JESTE PODESAVANJE, KAKO BI WebSocket RADIO U Nginx-U

DA I TO JE POTREBNO URADITI

ALI PRE TOGA JOS NEKE INFORMACIJE

KADA SE USPOSTAVI TA WEBSOCKET KONEKCIJA IZMEDJU SERVERA I CLIENT-A. SERVER CE KONSTANTNO PING-OVATI; DAKLE VEZA SE STALNO ODRZAVA ZIVOM

OTPRILIKE SVAKIH PET SEKUNDI BISMO TREBALI DA DOBIJEMO PING

## KAKO NA PRIMER SAGLEDATI TAKVU KONEKCIJU U Network TAB-U, CHROME DEV TOOL-S

>>>> You need to reload the page with the network tab open and filter by type 'ws'

>> you will see entry about connection to the websocket, on the main Network tab listing.

DAKLE PROTOKOL JE **ws://**

This will show you a connection being made with a websocket

>> You can then click on the connection to show the traffic being sent back and forth with on the server

I BITNO JE DA POGLEDAM TAB **Frames**

**OVO JE ODLICAN RESURS UPRAVO GDE JE SVE POKAZANO** (RADI SE O ZVANICNOJ STRANICI CHROME DEV TOOLS-A)

<https://developers.google.com/web/tools/chrome-devtools/network/reference#frames>

### ONO STO CU KORISTITI, TRENUTNO JESU SAMO PURE WebSocket-OVI, NECU DAKLE KORISTITI socket.io (OVDE GOVORIM O CLIENT STRANI)

ALI OSTAVICU OVDE LINK, PA SE U BUDUCNOSTI POZABAVI OVIM LIBRARY-JEM

<https://socket.io/>

### NA SERVER STRANI, POTREBNO JE INSTALIRATI *ws* PAKET I NARAVNO POTREBNO GA JE REQUIRE-OVATI DA BI GA UPOTREBIO

ALI TO OTOM POTOM, KADA BUDEM DEFINISAO NOVI NODE APPLICATION

[ws: a Node.js WebSocket library](https://www.npmjs.com/package/ws)

## DA BI UCINILI DA WEBSOCKET RADI U U Nginx-U, MORAMO KORISTITI, NESTO STO JE POZNATO KAO **UPGRADE REQUEST**

DAKLE MORAM MODIFIKOVATI nginx.conf FAJL

U TVOM location BLOK-U

```linux
location / {
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";

  proxy_pass http://127.0.0.1:3000;
}
```

SECAS SE DA SI proxy_pass ODAVNO DODAO (AKO NISI ODAVNO ZAKLJUCIO 'proxy' ZNACI 'PUNOMOC' U PREVODU)

SADA DODAJES SAMO ONA GORE PRVA DVA REDA; ODNSNO DODAJES DVA proxy_set_header

- sudo vi /etc/nginx/sites-availble/default

DODAVANJE POMENUTIH HEADERA

**OMOGUCICE DA WEBSOCKETS STREAM-UJU DO TVOJE NODE APLIKACIJE**

ZASTO SE GOVORI O UPGRADE-U; PA ZATO STO SU NA PRIMER WEB SOCKETS, NAPREDNIJA STVAR U ODNSU NA REGULAR CONNECTIONS

## DA BI KORISTIO WEBSOCKETS MORAM, USTVARI URADITI SLEDECE

MORAM SE

- CONNECT IN IN A CLIENT

- ROUT IT THROUGH TO YOUR SERVER, U TVOJU Nginx KONFIGURACIJU

- Nginx TREBA ONDA DA ROUTE-UJE TAJ WEBSOCKET TO YOUR EXPRESS APPLICATION, AKO KORISTIS EXPRESS (NARAVNO MOZE I BEZ EXPRESS-A, MOGU KORISTITI CIST NODE)

- EXPRESS APPLICATION NEEDS TO HANDLE THAT WEBSOCKET; I RESPOND-UJE ALLL THE WAY BACK TO THE TUNEL

## ONO STO SE JOS MOZE URADITI U POGLEDU Nginx KONFIGURACIJE JESTE DODAVANJE JOS JEDNOG location BLOKA

TADA BIH ROUTE-OVAO TRAFFIC TO A DIFFERENT NODE APPLICATION

## OVO POSLEDNJE MI OMOGUCAVA pm2 PROCESS MANGER

JER MOGU DA RUNN-UJEM 50 NODE APPLIKACIJA, AT THE SAME TIME AKO TO ZELIM

## STO SE TICE LOKLNOG DEVELOPMENTA

