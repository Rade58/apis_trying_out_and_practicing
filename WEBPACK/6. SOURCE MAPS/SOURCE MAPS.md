# SOURCE MAPS

**SOURCE MAPS **

PRVO CU SE POZABAVITI TIME, STA SU TO USTVARI SOURCE MAPS

A U TOME CE MI POMOCI SLEDECI [CLANAK](https://www.schneems.com/2017/11/14/wtf-is-a-source-map/) I NJEGOVI CITATI

DANAS KADA POGLEDAM SAJTOVE, NJIHOVI JAVASCRIPT IL ICSS FAJLOVI NISU SIMPLE TEXT FAJLOVI

**DAKLE KADA GENERISEM, FOR PRODUCTION, MOJ JAVASCRIPT ILI CSS, KORISCENJEM BUNDLERA, JA USTVARI KREIRAM MINIFIED, FAJL IZ KOMPLEKSNOG BUILD PROCESA , KOJI UKLJUCUJE PROCESE COMPILING-A ILI TRANSPILING-A**

>> For example, CSS can be generated from a SASS file. JS can be compiled from ES6 using Babel

note: **[RAZLIKA](https://stackoverflow.com/questions/44931479/compiling-vs-transpiling) IZMEDJU COMPLING-A I TTRANSPILING-A** (PROCITAJ TOP RATED ODGOVOR) (CISTO DA ZANAS)

POMENUTI TOOLCHAIN-OVI (KOMPAJLIRANJA I TRANSPILING-A), OLAKSVAJU RAD DEVELOPERIMA, I DOBRE PRAKSE KAO STO JE MINIFICATION CINE MNOGO LAKSIM

## PROBLEM U MINIFIED FAJLU

STA RADIM KADA IMAM ERROR U MINIFIED FAJLU?

DAKLE, AKO POSTOJI EXCEPTION U FAJLU, KOJI JE MINIFIED, U KOJEM SU IMENA VARIJABLI SKRACENA, I UZ TO SVE JE U JEDNOM LINE-U; STO ZNACI DA JE NEMOGUCE ZNATI ODAKLE ERROR DOLAZI

**E PA SOURCE MAPS RESAVAJU, OVAJ PROBLEM**

## STA JE SOURCE MAP?

U OSNOVI, ONA DOZVOLJAVA BROWSER-U, DA MAPIRA IZVOR ASSET-A, SA JEDNE STRANE I FINALNI PROIZVOD, SA DRUGE STRANE

>>  if the JS file would have a source map, it would allow the browser to translate the location of the error to the original unmodified file on disk

## KAKO SOURCE MAPS TACNO FUNKCIONISU?

TVOJ ASSET BUILD TOOL (WEBPACK), MORA DA IMA MOGUCNOST GENERISANJA SOURCE MAP-E

KADA JE SOURCE MAP AVAILABLE, BUILD TOOL MORA DA 'KAZE' BROWSERU DA SOURCE MAP, NEKAKO POSTOJI

TO JE OMOGUCENO KOMENTAROM U SOURCE MAP FAJLU

AKO POSTOJI SOURCE FAJL **alikacija.js**, OVAKO BI, NA PRIMER IZGLDAO, TAJ KOMENTAR

```javascript
//# sourceMappingURL=aplikacija.js-27b6d64dc918dd82a8f02f9537b12d8e059524bc53d6f2dac0f04825a60023f5.map

```

**SADA BROWSER ZNA DA SOURCE MAP POSTOJI**

## KAKO IZGLEDA FILE SOURCE MAP-E (MISLIM N NJEGOV CODE)?

EVO PRIMERA:

```javascript
{
  "version": 3,
  "file":"aplikacija.js",
  "mappings": "AAAA;AACA;AACA;#...",
    "sources": [
      "jquery.source-56e843a66b2bf7188ac2f4c81df61608843ce144bd5aa66c2df4783fba85e8ef.js",
      "jquery_ujs.source-e87806d0cf4489aeb1bb7288016024e8de67fd18db693fe026fe3907581e53cd.js",
      "local-time.source-b04c907dd31a0e26964f63c82418cbee05740c63015392ea4eb7a071a86866ab.js"
    ],
    "names":[]
}
```

STA ZNACE SVAKI OD KLJUCEVA (KEY-OVA)?

- version

VERZIJA SOURCE MAP-E, KOJU KORISTIM

- mappings

[BASE 64 ENCODING (VLQ)](https://en.wikipedia.org/wiki/Variable-length_quantity)

TO JE STRING, KOJI GOVORI BROWSER-U, KAKO DA MAPIRA (DO SOURCE FAJLOVA) LINES I LOKACIJE, U GENERISANOM FAJLU (MINIFIED FAJLU)

VREDNSOT U PREDHODNOM PRIMERU JE TRUNCATED (PREKINUTA, ODNOSNO CHIPPED), JER MOZE DA BUDE VEOMA DUGACKA

- file

TRENUTNI MINIFIED FAJL, DO KOJEG SU MAPIRANI SOURCE-VI

- sources

NIZ SOURCE FAJLOVA

U PREDHODNOM PRIMERU, TI SU FAJLOVI, KOJI SU KORISCENI DA SE GENERISE aplikacija.js FAJL

- names

IMENA FUNKCIJA, AKO SU AVAILABLE

## POSTO SAM SE DO ODREDJENOG NIVOA UpOZNAO SA SOURCE MAPAMA, SADA CU SE VRATITI NA WEBPACK I KAK OSE ON KORISTI DA BI GENERISAO SOURCE MAPS

POSTOJI VARIJETET, RAZLICITIH FORMATA, U KOJIMA MOGU GENERISATI SOURCE MAP, UZ KORISCENJE WEBPACK-A

I SVI ONI IMAJU TRADE-OFFS (KOMPROMISNO, ODNOS MANA I KORISNOSTI OD FORMATA DO FORMATA VARIRA), KAO I SVE U PROGRAMIRANJU

OTICICU SADA NA [WEBPACK-OVU STRANICU, GDE JE OBJASNJENO SVE O KONFIGURACIJI](https://webpack.js.org/configuration)

I GDE MOGU NACI, [SVAKI CONFIGURATION PROPERTI](https://webpack.js.org/configuration#options)

U INTERAKTIVNOM PRIKAZU CODE-A KONFIGURACIJE, MOGU KLIKNUTI NA BILO KOJI PROPERTI, I TO CE ME ODVESTI DO OBJASNJNJA ZA POMENUTI PROPERTI

MEDJU TIM PROPERTIJIMA MOGU NACI I

- [devtool](https://webpack.js.org/configuration/devtool)

**POMENUTI PROPERTI JE OGOVORAN ZA DEFINISANJE SOURCEMAP-E**

MEDJUTIM, UMESTO DEFINISANJA PROPERTIJA, MOGUCE JE DEFINISATI I

- *SourceMapDevToolPlugin* (PROPERTI JE, SLEDECEG: require('webpack'), POPUT JOS NEKIH PLUGIN-OVA, KOJE SAM POMENUO U RANIJIM md FAJLOVIMA)

NA STRANICI GDE JE OBJASNJEN, POMENUTI PROPERTI, I GDE JE NAVEDEN POMENUTI PLUGIN, NALAZI SE I TABELA, U KOJOJ SU OBJASNJENE, SVE MOGUCE VREDNOSTI, ZA devtool PROPERTI (LEPO JE OZNACENO PLUSEVIMA I MINUSIMA I JOS NEKIM OZNAKAMA, KOJE SU PREDNOSTI I MANE RELATED SOURCE MAPE, I DA LI SE ONA TREBA KORISTITI U PRODUCTION-U ILI NE), A OBJASNJEN JE I KVALITET SOURCE MAP-E

ODNOSNO, KADA GOVORIM O POMENUTIM PLUSEVIMA IMINUSIMA, REC JE O BRZINI

>>>> +++ super fast, ++ fast, + pretty fast, o medium, - pretty slow, -- slow

KSDS GOVORIM O BRZINAMA MISLI SE NA BRZINE BUILD-A I REBUILD-A

## AKO ZELIS MOST ORIGINAL BREAKPOINTS, I DA SVE IZGLEDA,  IDA SVE RADI U BILO KOJEM BROWSER-U BIRACES VREDNOST source-map, KAO VREDNOST ZA devtool PROPERTI

OTICI CU SADA U MOJ PRODUCTION CONFIGURATION I DODACU devtool PROPERTI SA POMENUTOM VREDNOSCU

```javascript
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = () => {
    return {
        // MOGU GA DODATI OVDE
        devtool: 'source-map'
        output: {
            filename: 'bundle.js'
        },
        module: {
            rules: [
                {test: /\.css$/, use: [MiniCssExtractPlugin.loader, "css-loader"]}
            ]
        },
        plugins: [
            new MiniCssExtractPlugin()
        ]

    }
}
```

POKRENUCU SADA U TERMINALU PRODUCTION SCRIPT, ALI CU DODATI I COMPRESSION PRESET KONFIGURACIJU

- yarn prod --env.presets compress

SADA AKO POGLEDAM dist FOLDER, PORED OSTALIH FAJLOVA, TU SU GENERISANI (ILI EMITTED) I

- bundle.js.map

- bundle.js.map.gz

- main.css.map

- main.css.map.gz

**UOSTALOM, AKO POGLEDAM MESSAGE U SAMO MTERMINALU, VIDECU STA JE SVE EMITTED**

## AKO ZELIM LIVE DEMO, OVIH SOURCE MAP-A, MOGU IH DEFINISATI I ZA DEVELOPMENT MODE

webpack.development.js FAJL

```javascript
module.exports = () => ({
    // DEFINISEM DAKLE devtool OVDE
    devtool: "source-map"
    output: {
        filename: '[hash].js'
    },
    module: {
        rules: [
            {test: /.css$/, use: ["style-loader", "css-loader"]}
        ]
    },

})
```

POKRECEM DEVELOPMENT SCRIPT, ALI ZAJEDNO SA COMPRESSION PRESET-OM

- yarn dev -- --env.presets compress

MOGU SADA DA ODEM U CHROME, I OTVORIM PROVIDED localhost

U **CHROME DEV TOOLS**-U, OTVARAM **Sources** TAB

TAM OCU VIDETI OBAVESTENJE DA SU **SOURCE MAPS DETECTED**

**ODNOSNO, PRVO STO CU VIDETI JESTE MINIFIED JS FAJL (KOJI JE HASHED, JER SAM TAK ODEFINISAO (IAKO NISAM MORAO ZA DEVELOPMENT))**

**KADA ODEM NA DNO TOG FAJLA PRONACI CU KOMENTAR SA sourceMappingURL-OM** (O TOM KOMENTARU SAM GOVORIO NA POCETKU OVOG md FAJLA)

ONO STO JOS MOGU PROCITATI, KADA KLIKNEM NA **more** LINK IZNAD PRIKAZA, JESTE DA:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "You can debug these resolved source files as a regular JavaScript files"

- *A SOURCE FAJLOVI SU DOSTUPNI, KADA PRISTISNEM **Ctrl + P***

KADA OTVORIM TO, OTVARA SE LISTA, SA SEARCH FIELD-OM, TAKODJE

**MOGU KUCATI IME ZELJENOG FAJLA** (SVAKI MODUL JE DOSTUPAN)

ALI LISTA JE OTVORENA I MOGU OTVORITI, BILO KOJI SOURCE FAJL O ODPOCETI SA DEBUGGING-OM

A SA STRANE, IMAM MENI I IMAM REPREZENTACIJU SVIH FAJLOVA MOG PROJEKTA (FAJL FOLDER STRUKTURA)

TAMO JE webpack FAJL, I KADA GA OTVORIM, MOGU VIDETI SVE FAJLOVE I node modules

U src FOLDER-U SE NALAZE SVI SOURCE FAJLOVI

**KADA OTVORIM FAJL, MOGU OTPOCETI SA DEBUGGING-OM, POSTAVLJAJUCI BREAKPOINT-E** (TREBA MI DETALJAN TUTORIJAL KAK OSE KORISTE BREAKPOINT-I)

## MALO SAM PROVALIO, I KAKO BREKPOINTI FUNKCIONISU

POSTAVIM BREAKPOINT U CODE-U I ONDA RELOAD-UJEM STRANICU

CODE CE SE EXECUTE-OVATI DO TOG MESTA GDE SAM PODESIO BREAKPOINT, BEZ OBZIRA KOJI JE FAJL U PITANJU

A IMAM I OPCIJU DA NASTAVIM SA EXECUTIONOM

**STVARNO HELPFUL STVARCICA**

## KORISCENJE BREAKPOINT-A JESTE 'DEBUG DRIVEN DEVELOPMENT', KOJI KAKO KAZE LARKIN JESTE NJEGOV OMILJENI TIP DEVELOPMENT-A

DAKLE BREAKPOINTE, TREBAM DA KORISTIM STO CESCE, UMESTO console.log -INGA, KAO STO OBICNO RADIM

## U PREDHODNOM PRIMERU, KORISTIO SAM devtool: "source-map"; STO MI DAJE MOST ACURATE SOURCE MAPS, ALI HAJDE DA VIDIM, NEKE DRUGE VREDNOSTI, ODNOSNO DRUGE KVALITETE I VIDIM STA TO JA ZRTVUJEM ZBOG BRZINE

[GLEDAM OPET TABELU devtool VREDNOSTI](https://webpack.js.org/configuration/devtool#devtool)

IZABRACU NA PRIMER

- cheap-module-source-map

MOGU DA VIDIM DA IMA MEDIUM SPEED BUILD, SLOW REBULD, KORISTI SE ZA PRODUCTION I KVALITET JOJ JE ORIGINALNI CODE(LINES ONLY)(PREDPOSTAVLAM DA LINES ONLY ZNACI DA SU KOMENTARI IZBACENI)

DAKLE PREDSTAVLJA MEDIUM TRADE-OFF

POMENUTI MODUL SE PO DEFAULTU KORISTI ZA create-react-app (KAKO KAZE LARKIN)

webpack.development.js FAJL

```javascript
module.exports = () => ({
    // DEFINISEM
    devtool: "cheap-module-source-map",
    output: {
        filename: '[hash].js'
    },
    module: {
        rules: [
            {test: /.css$/, use: ["style-loader", "css-loader"]}
        ]
    },

})
```

DAKLE, OPET CU GA KORISTITI U DEVELOPMENT MODE-U

- yarn dev -- --env.presets compress

NISAM SIGURAN STA VIDIM U BUNDLE FAJLU SADA KADA OTVORIM POMENUTI FAJL U Sources TABU

ON OSTO LARKIN KAZE JESTE DA SE SADA, NA PRIMER U BUNDLE-U NALAZI CODE HOT MODULE REPLACEMENTA (POSTIGNUTO UZ POMOC --hot) TO JE CLENT CODE, KOJI JE INLINED KADA KORISTIM DEV SERVER SA --hot FLAGOM

NA PRIMER KADA SADA OTVORIM CSS FAJLOVE, VIDECU NEKI CODE, KOJI LICI NA JAVASCRIPT (NE VIDIM KAKO BI TO MOGAO DEBUG-OVATI (MOZDA JE TO BAS NAMENJENO TOME DA NIKO NE MOZE DIREKTNO HACK-OVATI CSS FAJL))

## OVDE SE VIDI VAZNOST PRESETA, JER ZA ODREDJENI PRESET JA MOGU DEFINISATI SOURCE MAPPING, I VRSITI DEBUGGING

## AKO OPET POGLEDAM ONU TABELU

[GLEDAM OPET TABELU devtool VREDNOSTI](https://webpack.js.org/configuration/devtool#devtool)

MOGU VIDETI NEKE VREDNOSTI PRI DNU TABELE, KAO STO SU NA PRIMER **inline-source-map**

TADA CE SOURCE MAP-A BITI INLINED U MODULU

**PRIMETICU AKO TO URADIM DA CE MI BUNDLE BITI JAKO VELIKI** (ZATO UPRAVO I PISE DA OVO NE TREBA KORISTITI ZA PRODUCTION)

ZATIM POSTOJI **hidden-source-map**

**NEKI MAPPING I DIRACTORY INFORMATION-I NECE BITI EXPOSED** (ALI  IDALJE DOBIJAM SOURCE MAP QUALITY)

POSTOJI I **nosources-source-map**

>>>> NEKI LJUDI OUTTHERE MISLE DA JE POTREBNO 'SAKRITI BILO KAKAV SOURCE'

**TO JE NEMOGUCE JER TI SHIPP-UJES ASSET-E, KOJI SU PUBLIC NA WEBSAJTU, TAKO DA BEZ OBZIRA NA SVE LJUDI MOGU VIDETI IZVORE AKO ZELE**

KORISCENJEM POMENUTE OPCIJE TI MOZES SAKRITI SOURCE, ALI I ON I DALJE MAPPIRA [STACK TRACES](https://stackoverflow.com/questions/591857/how-can-i-get-a-javascript-stack-trace-when-i-throw-an-exception)

TAK ODA CES VIDETI PATH GDE SE POJAVLJUJE TVOJ ERROR U STACK TRACE-U, I ONDA SE MAPPIRA BACK TO THAT

*NEKADA SEFOVI NE ZNAJU DA SU SOURCES EXPOSED ANYWAY I ONDA KAZU DEV-OVIMA DA SAKRIJU SOURCE A EXPOSE-JU STACK TRACE*

ONDA JOS POSTOJI OPCIJA **eval** STO SE KORISTI PO DEFAULT-U U DEVELOPMENT MODE-U
SUPER FAST INITIAL BUILD I SUPER FAST REBUILD-OVI

**NE KORISTI SE ZA PRODUCTION JER SVE SE WRAPP-UJE U eval STRINGS, STO ZNACI DA CE BUNDLE-OVI BITI NESTO VECI I eval DONOSI SECURITY ISSUES I DEOPS-UJE JAVASCRIPT PERFORMANSE**

## AKO OPET POGLEDAM STRANICU, GDE JE OBJASNJEN devtool, IMAM DETALJNA OBJASNJENJA U VEZI POMENUTIH VREDNOSTI, ODNOSNO TRADE-OFF-OVA

[OBAJSNJENJA VEZANA ZA QUALITY, DEVELOPMENT, PRODUCTION I OSTALO A TICE SE SOURCE MAP-A](https://webpack.js.org/configuration/devtool#qualities)

