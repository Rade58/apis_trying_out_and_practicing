# KREIRANJE CUSTOM LOADER-A

SAV DEO KOJI SE OVOGA TICE NEMAM VREMENA DA ZAPISEM

UGLAVNOM TREBAM PREGLEDATI, OPET SVE LARKIN-OVE SNIMKE

## STO SE TICE LOADER-A, NAJBOLJE JE DA DEFINISEM JEDAN LOADER ZA MOJU KONFIGURACIJU

JEDAN PROPERTI, KOJI SE DODAJE KONFIGURACIJI JE:

- **resolveLoader**

ONO STO NIKAD DO SADA NISAM KORISTIO JE PROPERTI resolve KOJI MOGU KORISTITI ZA BILO KOJI MODUL

## NA POCETKU, KREIRACU USTVARI PRESET, ON CE SE ZVATI webpack.myloader.js I TREBA DA KORISTI MOJ LOADER

*/build_utils/presets/**webpack.myloader.js***

```javascript
// STO SE TICE FAJLA U KOJEM TREBA DA BUDE, MOJ LOADER, TO CE BITI
//                                                                  build-utils/my-loader.js

module.exports = () => ({
    resolveLoader: {
        alias: {
            // "my-loader": require.resolve('./build-utils/my-loader.js') // OBRATI PAZNJU I NA OVO JER TVOJ CODE NECE RADITI ZBOG OVOG PATH-A

            // JER require.resolve CE POKUSATI DA RESOLVE-UJE POMENUTO U ODNOSU NA
            // TRENUTNI FAJL, A APTH DO LAODER FAJLA, KADA POSMATRAM SA OVOG FAJLA U KOJEM PISEM
            // JESTE:     '../my-loader.js'
            // DAKLE OVAKO BI BILO PRAVILNO
            "my-loader": require.resolve('../my-loader.js')

            // NE ZNAM ZASTOJE OVO OVAKO
            // VALJDA SE ZATO I KORISTI RESOLVER OVDE DA NE BIH KUCAO CEO PATH KAO STO SAM GORE POGRESNO URADIO
            // I KASNIJE COMMENT-OVVAO OUT
        }

    },

    // NEKA SE MOJ LOADER, NA PRIMER KORISTI ZA CSS FAJLOVE
    module: {
        rules: [
            {test: /\.css$/, use: "my-loader"}
        ]

    }
})
```

## A EVO KREIRACU I LOADER

build_utils/**my-loader.js**

```javascript
// LOADER JE USTVARI FUNKCIJA KOJA UZIMA SOURCE I RETURNUJE DRUGI SOURCE

module.exports = source => {

    // BITNO JE RECI DA JE source UPRAVO STRING

    // ODNOSNO SOURCE JE SAV SOUCE CODE KOJI JE BUNDLED (VIDECES I USKORA ZASTO SAM TO REKAO)

    // HAJDE DA OVDE DODAM BREAKPOINT
    debugger;


    // POSTO JE OVO SAMO OGLEDNO A I NEMAM PREDSTAVU STA DA LOAD-UJEM, RETURN-UJEM ISTI SOURCE
    return source;
}

```

## HAJDE DA FORMIRAM I DEBUGGING SCRIPT, A TAJ SCRIPT TREBA DA MERGE-UJE MOJ NOVI PRESET SA GLAVNOM KONFIGURACIJOM I SA DEVELOPMENT KONFIGURACIJOM (TAKO SI DEFINISAO VEC DAVNO RANIJE UPOTREBOM webpackMerge-A I PAMETNIM COMPOSING-OM SCRIPT-OVA (DA NE SIRIM PRICU, POGLEDAJ MOJ CODE)) ALI KREIRACU I NORMALNI SCRIPT U KOJEM NECU MOCI PODESAVATI BREAKPOINTE

NEKA TO BUDE

"dev:my-loader:debug" : "npm run dev:debug -- --env.presets my-loader"

I NEKA TO BUDE

"dev:my-loader": "npm run dev -- --env.presets my-loader"

## SADA KADA OTPOCNES DEBUGGING, VIDECES DA CES DO BREAKPOINTA KOJ ISI POSTAVIO DOCI GOTOVO ODMAH

ON JE DAKLE PAUZIRAO DO PRVOG CSS MODULA, NA KOJI JE NAISAO

**LARKIN KASE: "LOADER IS APPLIED ON PROFILE BASES"**

DAKLE LOADER JE APPLIED ZA SVAKI MODUL I MATCHER MATCHUJE AGAINST IT (U MOM SLUCAJU ZA SVAKI CSS MODUL)

JA U MOM PROJEKTU IMAM NEKOLIKO CSS MODULA KOJE SAM KORISTIO (IMPORTOVAO SI NEKOLIKO CSS FAJLOVA)

I SVAKI PUT PRITISKAJUCI PLAY U DEBUGGER-U PAUZIRACE SE KOD JEDNOG OD CSS MODULA

A JA NARAVNO U OBIM UDEBUGGER-A IMAM PRISTUP source-U

**source** PARAMETAR JE ZA SLUCAJ MOG PRIMERA, STRINGIFIED CSS TRENUTNOG CSS MODULA

## SADA KADA TO ZNAM HAJDE DA DEFINISEM NESTO U OBIMU MOG LOADER-A

```javascript
module.exports = source => {

    // EVO ALTER-OVACU source ZA SVAKI CSS MODUL

    source += `

    body {
        background-color: olive;
        border: tomato solid 28px;
    }

    `

    debugger;
    
    return source;      // SADA DAKLE SALJES IZMENJEN STRINGIFIED CSS

        // DO DUSE OVO CE SVAKOM OD CSS MODULA DODATI ISTI CSS CODE, I TAKAV CODE CE ICI U BUILD

}
```

## SADA KADA RUN-UJEM ONAJ SCRIPT KOJI SAM COMPOSE-OVAO, KOJI NIJE DEBUGING SCRIPT

MISLIM NA

"dev:my-loader": "npm run dev -- --env.presets my-loader"

**MOCI CU SA PROVIDED LOCALHOST-A VIDETI NA SAMOM PAGE-U DA LI JE ZNACILO ONO STO SAM MENJAO SOURCE DODAJUCI MU NOVI CSS**

I DA ZAISTA NA STRANICI, BACKGROUND COLOR body-JA JE PROMENJEN, ZAJEDNO SA BORDEROM

## ISTA SITUACIJA BI BILA I DA SAM NAPRAVIO LOADER ZA JAVASCRIPT

DAKLE ZA PRVI FAJL KOJI BI HTT-OVAO DEPENDANCY GRAPH JA BIH GA IMAO STRINGIFIED KAO source

NA POCETKU TOBI BIO MOJ ENTRY POINT index.js

I DAKO DALJE, **LOADER BI SE TRIGGER-OVAO ZA SVAKI OD JS MODULA KOJE SAM KREIRAO**

## SAD TI MOZE BITI JASNIJE KAK OFUNKCIONISE NA PRIMER TYPE SCRIPT LOADER ILI SASS LOADER

SA JEDNE STRANE ULAZI TYPESCRIPT ILI SASS, A IZLAZI JS ODNOSNO CSS

## ONO STO JOS MOGU URADITI JESTE RUNN-OVATI DEBUGGING SCRIPT, I NA BREAKPOINTU, KOJI SAM DEFINISAO, POKUSATI DA U DEBUG CONSOLE-U PRISTUPAM NA PRIMER this-U

this BI U TOM SLUCAJU PREDSTAVLJALO FAJL, ODNOSNO RAZLICIT METADATA, VEZAN ZA TRENUTNI FAJL

**DAKLE MOGAO BI DA REDEFINISEM LOADER KAKO BI ON BIO LOADER ZA JAVASCRIPT**

CISTO DA VIDIM KAKO BI TO IZGLEDALO

```javascript
// build-utils\presets\webpack.my-loader.js

module.exports = () => ({
    resolveLoader: {
        alias: {
            "my-loader": require.resolve('../my-loader.js')
        }

    },

    module: {
        rules: [
            {test: /\.js$/, use: "my-loader"}    // SAD JE js
        ]

    }
})
```

```javascript
// build-utils\my-loader.js

module.exports = source => {

    // SAD SAM SOURCE-U DODAO STRINGIFIED JAVASCRIPT CODE
    source += '; console.log("blah");';

    // EVO GA this KAO CLOSURE (NE MORA DA BUDE ALI NEKA GA)

    this;

    debugger;

    return source;

    // SADA BI TREBALO DA IMAM MNOSTVO console.log POZIVA U BUNDLE
    // JER JE OVO (MOJ ALTERING RETURNED VALUE-A) DODALO PO console.log ZA SVAKI MODULU

}
```

## SADA MOGU RUNN-OVATI DEBUGGING DEVELOPMENT SCRIPT DA VIDIM, KOJA JE VREDNOST this OBJEKTA INSIDE LOADER SCOPE

**MEDJUTIM, POSTO VEC IMAS LAODER**

- npm run dev:my-loader:debug

SADA MI JE this CLOSURE U OBIMU LOADER-A, IAKO NIJE MORALO BITI

## :weary::weary::weary::weary: this JE undefined, KAKO SADA VIDIM, A NE BI TREBAL OTAKO BITI

NE BAS, PO LARKINOVIM RECIMA

MEDJUTIM I WEBPACK SE UPDATE-OVAO TOKOM VREMENA I VEROVATNO JE IZBACENA TA MOGUCNOST DA SE this VIDI

ILI JE TO U PITANJU ILI JA RADIM NESTO STO NE TREBA
