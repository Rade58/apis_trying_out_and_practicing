# KREIRACU PLUGIN U SKLOPU, MOG PROJEKTA, ZA KOJI SAM WEZBAO WEBPACK

[PROJEKAT](https://github.com/Rade58/insta_pwa_cloneW)

## POLAZNA TACKA

DA SAM MALO BOLJE NAUCIO ANATOMIJU WEBPACKA ZNAO BI DA:

PLUGIN JE SAMO **JAVASCRIPT CLASS-A**, KOJA IMA **apply** METODU

ODATLE CU DA POCNEM

KREIRACU SLEDECI FAJL

### build_utils/**MyFirstWebpackPlugin.js**

>>>> *s obzirom da se obicno ljudi zele da publish-uju plugin naming patter bi bio*

- **BiloKojeIme*WebpackPlugin***

```javascript
class MyFirstWebpackPlugin {

    // FUNKCIJI SE PROSLEDJUJE COMPILER
    apply(compiler){

    }
}

module.exports = MyFirstWebpackPlugin;

// JA VEC MOGU DA KORISTIM OVAJ PLUGIN
// NISTA SE NECE DESITI, ALI MOGU DA GA RUNN-UJEM
```

JA CU TO I URADITI U KONFIG FAJLU

*webpack.config.js*

```javascript
const webpack = require('webpack');
const webpackMerge = require('webpack-merge');

const modeConfig = env => require(`./build-utils/webpack.${env}`)(env);
const addMergedPresetsConfigs = require('./build-utils/loadPresets');

// UVOZIM MOJ PRVI PLUGIN
const MyFirstWebpackPlugin = require('./build-utils/MyFirstWebpackPlugin')

module.exports = ({mode, presets} = {mode: "none", presets: []}) => {

    return webpackMerge(
        {
            /* optimization: {
                splitChunks: {chunks: "all"}
            }, */
            mode,
            output: {
                filename: 'bundle.js'
            },
            plugins: [
                new webpack.ProgressPlugin(),
                // EVO GA OVDE INSTATICIZIRAM
                new MyFirstWebpackPlugin()
            ],
            module: {
                rules: [
                    {
                        test: /\.(jpe?g|png|svg)$/,
                        use: [
                            {loader: "url-loader", options: {limit: 5000}}
                        ]
                    },
                    
                ]
            }
        },
        modeConfig(mode),
        addMergedPresetsConfigs({presets})
    )
}
```

## MOGU DA POKRENEM BILO KOJI OD SCRIPTOVA

NA PRIMER dev

BUILD CE BITI USPESAN

ALI NISAM NISTA URADIO SA MOJIM PLUGINOM

DAKLE NEMAM NEKU FUNKCIONALNOST U MOM PLUGINU, ALI TO JE BIO PRVI STEP PRI KREIRANJU, MOG PLUGIN-A

## POSTOJE NEKI HOOK-OBI KOJI SU SPECIGFIC ZA SAMO NEKI OD POMENUTIH 7 TAPABLE-OVA (COPILATION, PARSER, WTACH MODE..)

AKO ZELIM DA NA PRIMER DA DEFINISEM PLUGI NZA DEV, MORAO BI DA SE HOOK-UJEM U WATCH BASED HOOKS

## MOGU DEFINISATI NA PRIMER DA KADA WEBPACK ZAVRSI SA BUILDING-OM FAJLOVA, DA CONSOLE LOGGUJEM NESTO

## A DA PRONADJEM POTREBNI HOOK, MOGU OTICI U NA PRIMER node_modules/webpack/lib/Compiler.js

**ALI U TOM lib FOLDER-U, JA MOGU NACI SVASTA**

*SECAS SE KAKO JE LAKO SERCH-OVATI U VS CODE IDE-U* **SAMO PRISTISNES NA FILE EXPLORER (LEVA TRAKA GDE SE NALAZE PREDSTAVLJEN IFAJLOVI I FOLDER)** (PROSTO KUCAM STA ZELIM)

KUCAO SAM `Compiler.js`

I ODMAH JE PRONADJEN FAJL

## U FAJLU MOZES DA SERCHUJES `extends Tabaple` I PRONACI CES Copiler KLASU KOJA EXTEND-UJE Tapable

ODMAH CES PRIMETITI HOOK-OVE

## POSTO SE Compiler INSTANCA PROSLEDJUJE apply METODI, JA CU SADA U apply FUNKCIJI PRISTUPITI ASINHRONOM HOOK-U, KOJI SE ZOVE done

TU POSTOJI I emit KOJA SE RUNN-UJE DOK SE FAJLOVI EMITUJU NA DISK

JA CU IPAK KORISTITI, **done**

## METODA, KOJU PRIMENJUJEM NA HOOK JE tapAsync I PREDSTAVLJA API ZA TAPPING IN

- PRVI ARGUMENT tapAsync-A JESTE IME MOG PLUGIN-A

- DRUGI ARGUMENT JE CALLBACK, KOJE JE PRIVI PARAMETAR, USTVARI STATS OBJEKAT (U SAMO MSOURCE CODE-U SAM MOGAO TO I VIDETI: 'stats'); A DRUGI PARAMETAR JE CALLBACK

**POMENUTI CALLBACK PARAMETAR JE TU, JER JE REC O ASYNC HOOK-U**

build_utils/**MyFirstWebpackPlugin.js**

```javascript
class MyFirstWebpackPlugin {

    apply(compiler){

        //
        compiler.hooks.done.tapAsync("MyFirstWebpackPlugin", (stats, callback) => {

            // ONO STO BI SE TREBALO ODMAH SETITI DA URADIM, JESTE POZIVANJE CALLBACKA
            // JER TOKO MTESTIRANJA MOGU UCI U ZABLUDU U CUPATI KOSU ZASTO NISTA NIJE RADILO
            // RAZLOG BI BIO TO STO SAM MOZADA ZABORAVIO DA POZOVEM CALLBACK

            // TREBA GA DAKLE POZVATI NA DNU
            callback();

        })
    }
}

module.exports = MyFirstWebpackPlugin;
```

## ONO STO CU DEFINISATI JESTE DA SE stats CONSOLE.LOG-UJU U TERMINALU

build_utils/**MyFirstWebpackPlugin.js**

```javascript
class MyFirstWebpackPlugin {

    apply(compiler){

        compiler.hooks.done.tapAsync("MyFirstWebpackPlugin", (stats, callback) => {

            //-----
            console.log(stats);

            //
            callback();

        })
    }
}

module.exports = MyFirstWebpackPlugin;
```

## MOGU SADA DA RUNN-UJEM PRODUCTION SCRIPT SCRIPT (LARKIN KAZE DA TO NE MOZE BITI DEVELOPMENT JER done NE RADI ZA WATCH MODE; MEDJUTIM KADA SAM RUN-OVAO DEV SCRIPT MENI SU SE SVI STATS, USTVARI STAMPALI TAK ODA done RADI I ZA WATCH MODE)

STATS SU OGROMNI I ONI CE BITI LOGGED U TERMINALU

**VIDECU SVU MOJU DATA U TERMINALU**

## E SADA JA MOGU DEBUGG-OVATI CODE MOG PLUGGIN-A, JER KAO STO SI NA POCETKU BAVLJENJA SA NODE-OM SAZNAO OD LARKINA, TI USTVARI MOZES KORISTITI CHROME, ZA DEBUGGING, NODE.js CODE-A, KOJI USTVARI JESTE WEBPACK-OV CODE

JA MOGU NARAVNO KORISTITI

- debugger STATEMENT

```javascript
class MyFirstWebpackPlugin {

    apply(compiler){

        compiler.hooks.done.tapAsync("MyFirstWebpackPlugin", (stats, callback) => {

            console.log(stats);

            debugger;

            callback();

        })
    }
}

module.exports = MyFirstWebpackPlugin;
```

[DEBUGGINGU CU OPET POSVETITI CEO JEDAN MD FAJL](https://github.com/Rade58/apis_trying_out_and_practicing/blob/master/WEBPACK/1%20%29%20PISANJE%20PLUGIN-A%20%28TRECI%20DEO%20TUTORIJALA%29/0%29%20DEBUGGING.md)

## POSTO SADA ZANAS KAKO DA DEBUGG-UJES SVOJ PLUGIN, ODNOSNO POSTO SI PROUCIO ON OSTO SAM NAPISAO NA md FAJLU DO KOJEG JE VODIO PREDHODNI LINK, MOZES USPESNO DA NASTAVIS DEFINSIANJE SVOG PLUGGIN-A

## DAKLE U CHROME DEDICATED NODE.js DEV TOOLS WINDOW-U, VIDEO SAM STAMPAN stats OBJEKAT

## MEDJU PROPERTIJIMA TOG OBJEKTA JE I Copilation INSTANCA

A stats IMA I SLEDECE PROPERTIJE

- hash (LARKIN KAZE DA JE WEBPACK DETERMINISTIC) (DAKLE TO JE POPUT GENERISANOG ID-JA CELOG BUILDA KKOJI JE RUNNED)

A TU SU I

- endTime

- startTime

RAZLIAK POPMENUTE DVE VREMENSKE VREDNSOTI, PREDPOSTAVLJAM DA PREDSTAVLA VREDNSOT U MILI SEKUNDAMA, ZA KOLIKO SE OBAVIO BUILD

## STO SE TICE Compilation INSTANCE KOJE JE VREDNSOT, ISTOIMENOG PROPERTIJA stats OBJEKTA, VIDIM DA TA Compilation INSTANCA IMA MNOGE PROPERTIJE

MEDJU NJIMA SU I **chunks**, ZATIM **entrypoints**I JOS MNOGO TOGA

## DAKLE stats IS CONTAINING ALL INFORMATIONS ABOUT MY BUILD

## AKO SADA U DEBUGGER KONZOLI (KOAJ SE NALAZI U SKLOPU TERMINAL SEKCIJE VS CODE-A), MOGU DAKLE PRISTUPATI SVIM VARIJABLAMA, ODNOSN OSVOM CODE-U, KOJI SE NALAZI U SCOPE-U MOG BREAKPOINT-A, ALI SAMO ONAJ CODE DAKLE KOJI JE PRE NJEGA

DAKLE JA U KONZOLI MOGU KOMOTNO UPISATI stats

KADA PRITISNEM ENTES stats CE BITI OUTPUTED U KONZOLI

## AKO U DEBUGGER KONZOLI UKUCAM stats.toString()

ONO STO CE SE OUTPUT-OVATI BICE UPRAVO ONO STO SE STAMPALO U SAMOM TERMINALU, KAO POSLEDICA ONOG **console.log(stats)**

## OVO UPRAVO ZNACI DA KADA SE, INACE RUNN-UJE WEBPACK, SVE STO JE OUTPUTED U KONZOLI, JESTE NASTALO KAO RETURNED VALUE stats.toString()

MOGU NA PRIMER RUNN-OVATI

- stats.toString("verbose")

I TO CE MI DATI OGROMAN BROJ INFORMACIJA O BUILD-U

**OVO SE MOGLO POSTICI I U CLI-U DODAVANJEM SLEDECEG FLAGA SCRIPT-U**

- `--verbose`

DAKLE UGLAVNOM, OD OUTPUTED CONTENTA U TERMINALU, MOGU NAUCITI SVE STO SE TICE MOG BUILD-A

## SADA JA USTVARI MOGU DA STAMPAM ASSET-OVE, MOJE KOMPILACIJE

CISTO DA OPET JOS JEDNOM PRIKAZEM CODE DA GA IMAM PRE DNOSOM

build_utils/**MyFirstWebpackPlugin.js**

```javascript
class MyFirstWebpackPlugin {

    apply(compiler){

        compiler.hooks.done.tapAsync("MyFirstWebpackPlugin", (stats, callback) => {

            console.log(stats);

            debugger; // ON JE JOS TU

            //
            callback();

        })
    }
}

module.exports = MyFirstWebpackPlugin;
```

## U DEBUG KONZOLI MOGU PRISTUPITI stats.compilation.assets

AKO BI ZELEO DA PROCITAM SVE ASSETS, POJEDINACNO, HTEO BIH DA IH IMAM U JEDNOM JAVASCRIPT NIZU

OVAJ assets OBJEKAT NIJE ITERABLE, ALI JA OTTO OD NJEGA MOGU NAPRAVITI UZ KORISCENJE METODE

- Array.from

DAKLE U DEBUG KONZOLI PISEM SLEDECE

- Array.from(**stats.compilation.assets**)

MEDJUTIM, ONO STO JA ZELIM JESTE DA IZLISTA MIMENA SVIH ASSET-OVA

build_utils/**MyFirstWebpackPlugin.js**

```javascript
class MyFirstWebpackPlugin {

    apply(compiler){

        compiler.hooks.done.tapAsync("MyFirstWebpackPlugin", (stats, callback) => {

            // USTVARI HAJDE DA NAPRAVIM NIZ OD SVIH IMENA, MOJIH ASSET-OVA

            const assetNames = []

            // KORISTIM for-in LOOP, JER SE OVDE NE RADI O ITERABLE OBJEKTU
            for(let assetName in stats.compilation.assets){

                assetNames.push(assetName);

            }

            debugger; // ON JE JOS TU, UDJI U DEBUG CONSOLE I PROCITAJ

            // NARAVNO PRE NEGO STO CITAS POTREBNO JE DA POKRENES DEBUG SCRIPT

            // I PRITISKOM PLAY DUGMETA DA DODJES DO BRAKPOINT-A, KAKO BI IZ NJEGOVOG SCOPE-A PROCITAO VREDNOST
            // aasstNames VARIJABLE

            //
            callback();

        })
    }
}

module.exports = MyFirstWebpackPlugin;
```

## ZELIM DA TE VODIM KROZ OVAJ DEBUGGING, KAKO BI VIDEO DIVOTU OVOGA SVEGA

- npm run prod:debug

- VIDECES U TERMINALU DA JE KRAJ (BICE PROVIDED URL KOJI POCINJE SA ws://)

- PRITISNI NA BUBICU NA LEVOJ STRANI VS CODE-A

- RANIJE SI MOZDA DODAO POMENUTI SCRIPT, ODNOSN OREGISTROVAO GA ZA DBUGGING U VS CODE-U

AKO NISI PRITINI NA MALI ZUPCANIK, KOJ ITI JE PROVIDED

- PRITISNI NA ADD CONFIGURATION I OTVORICE SE FAJL (U PITANJU JE launch.json FAJL VS CODE-A)

- AKO JE DODATA ISTA KONFIGURACIJA (DAKLE OVDE SE GOVORI O KONFIGURACIJI DEBUGGING-A), PORED POSTOJECE, NIJE TI POTREBNA, PA JE IZBRISI

- VIDIS SADA PLAY DUGME, I PORED NJEGA PADAJUCI MENU (TO TI JE PORED ZUPCANIKA)

- TAMO OTVORI TAJ MENU I PRITISNI 'Attach' (TO AKO PRVI PUT SVE OVO RADIS ZA PROJEKAT)

- SADA MOZES DA PRITISNES PLAY

- DEBUGGER JE OTPOCEO SVOJ RAD I PAUZA JE PRE SAMOG POKRETANJA CODE-A

- DOSTUPAN TI JE I MENU SA KOMANDAMA, MEDJU KOJIMA JE I PLAY DUGME, CIJIM PRITISKOM TI IDES OD BREAKPOINT-A DO BREAKPOINT-A

- PRITISNI DUGME NA POCETKU I CODE STARTUJE

- USTVARI BUILDING TVOG PRODUCTION CODE-A JE POCEO

- MOZES POSMATRATI TERMINAL KAO STO ZNAS I VIDECES PROGRES (GRAD ISE DAKLE TVOJ PRODUCTION CODE) (AKO SE SECAS TO JE POSLEDICA KORISCENJA ONOG PROGRESS PLUGIN-A)

- I TO GRADJENJE ODJEDNOM STAJE

- DOSAO SI DO SVOG ZADATOG BRAKPOINTA, U TVOM PLUGIN-U, KOJI SI KREIRAO

- TI MOZES NASTAVITI DALJE OD TOG BRAKPOINT-A, PRISTISKAJUCI, POMENUTI PLAY BUTTON, I VIDETI KAKO SE TVOJ PRODUCTION CODE GRADI DO KRAJA

- ALI TI ZELIS DA WEBPACK CODE OSTANE PAUZIRAN NE POMENUTOM BREAKPOINT-U, DA BI U DEBUG CONSOLE, PROVERIO VREDNSOT ONOG ARRAY-A KOJEG SI NAPRAVIO

- KUCAS assetNames (A VEC CES IAMTI I SUGESTIJ KAD OTKUCAS PRVIH NEKOLIKO SLOVA)

- PRISTISKAS ENTER I TVOJ NIZ JE OUTPUTED U DEBUG KONZOLI

- SADA MOZES DA POSMATRAS KOJI SU NJEGOVI CLANOVI

## ONO STO SLEDECE ZELIM DA POGLEDAM JESTE 