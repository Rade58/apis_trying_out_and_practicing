# PREFETCH I PRELOAD (U PITANJU SU OPET PROPERTIJI MAGIC COMMENTS-A)

OVAJ FEATURE JE DODADT U WEBPACK 4.6 (SREDINA 2018 GODINE)

A MOGU SAZNATI VISE O OVOME IZ [medium](https://medium.com/webpack/link-rel-prefetch-preload-in-webpack-51a52358f84c) PUBLIKACIJE

ONO O CEMU SE RADI OVDE JESU **`<link>`** TAGOVI, I NJIHOV PROPERTI **rel**

## STA PREDSTAVLJAJU VREDNOSTI "prefetch" I "preload", KOJI SU VREDNOSTI `<link>`-OVOG rel ATRIBUTA MOGU SAZNATI IZ mdn-OVOG OBJASNJENJA

[preload MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Preloading_content)

>The preload value of the `<link>` element's rel attribute lets you declare fetch requests in the HTML's `<head>`, specifying resources that your page will need very soon, which you want to start loading early in the page lifecycle, before browsers' main rendering machinery kicks in. This ensures they are available earlier and are less likely to block the page's render, improving performance.

[ovaj smashing magazine clanak](https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/) GOVORI O TOME GDE JE DOBRO KORISTITI POMENUTU preload VREDNOST

[prefetch MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Link_prefetching_FAQ)

>Link prefetching is a browser mechanism, which utilizes browser idle time to download or prefetch documents that the user might visit in the near future. A web page provides a set of prefetching hints to the browser, and after the browser is finished loading the page, it begins silently prefetching specified documents and stores them in its cache. When the user visits one of the prefetched documents, it can be served up quickly out of the browser's cache.

## OVO SU USTVARI RESOURCE HINT-OVI, KOJE GOVORE STVARI BROWSER-U

[MOZES SVE SAZNATI IZ WEBPACK-OVE PUBLIKACIJE](https://medium.com/webpack/link-rel-prefetch-preload-in-webpack-51a52358f84c)(*NE MORAS CITATI mdn-OVE CLANKE*)

prefetch GOVORI BROWSER-U: "EVENTUALLY, TREBACE MI OVAJ FAJL, PA GA LOADUJ ZA MENE" (DAKLE IMAM MOGUCNOST EAGERLY(ZELJENOG) LOAD-OVANJA), A TAKODJE fetch-uje ON IDLE TIME (NEAKTIVNOG VREMENA, NE PREKIDAJUCI RENDERING)

IMACU MANJE NETWORK REQUESTOVA, KADA KORISTIM OVO

**LARKIN NE ZNA BROWSER SPECIFIKACIJE O TOME U CEMU JE RAZLIKA IZMEDJU PREFETCH-A I PRELOAD-A; TAKO DA SE NI JA NECU BAVITI OVIM PRETERANO, VEC CU SE VRATITI AKO NEKAD ZATREBA**

*LARKIN KAZE DA PROVERIM TO AKO ZELIM*

U SUSTINI OVI PROPERTIJI U MAGIC COMMENT-U SE, MOGU KORISTITI ZAJEDNO

U SUSTINI AKO DEFINISEM NEKI OD NJIH PRI DEFINISANJU CODE SPLITTING-A

SVAKI CHUNK CE DOBITI SVOJ RELATED `<link>` TAG U head SEKCIJI PAGE-A, I U ZAVISNOSTI, KOJI SAM PROPERTI ZADAO OMOGUCI CE PREFETCHIN ILI PRELOADING RESURSA

**SAD NEKAKO MOGU VIDETI, NAROCITI KOD PREFETCHING, DA JE OVO USEFUL**

- STRANICA CE SE RENDER-OVATI I DESICE SE SAMO ONI DODATNI NETWORK REQUEST-OVI ZA JAVASCRIPTOM CSS-OM I SLIKAMA, KOJE SU NEOPHODNE INICIJALNO KADA KORISNIK OTVORI STRANICU

- A ONA ZA STA DEFINISEM CODE SPLITTING MOZE POCETI SVOJE UCITAVANJE 

- I JOS NAKON SLEDECEG RELOAD-A STRANICE, SLEDECI PUT RESURS CE SE SERVIRATI IZ CACHE-A

*DAKLE MOGU IZABRATI DA KORISTIM PREFETCH*

## KAKO SE ZADAJU POMENUTE VREDNOSTI? PA UZ POMOC PROPERTIJA webpackPrefetch I webpackPreload; U MAGIC COMMENT-U, A DODAJE IM SE BOOLEAN true VREDNOST, AKO ZELIM DA KORISTIM POMENUTO

DODACU SADA OVO U SLUCAJU MOG PRIMERA

```javascript
import neko_dugme from './dugme_blah';

const importElementDynamically = () => import(
    /* webpackChunkName: "some-balh" */
    /* webpackPrefetch: true */
    './neki_element'
);

document.body.prepend(neko_dugme);

neko_dugme.addEventListener('click', function(ev){
    importElementDynamically()
    .then(function(modul){
        document.body.append(modul.default);
    })
})

```

**MOGAO SAM SVE OVO ISPITATI U DEVELOPMEND MODE-U, ALI IPAK SAM SE ODLUCIO DA SAGRADIM BUNDLE U dist FOLDER-U I ONDA ISPITAM STVARI** (OVO JE MOZDA BILA GLUPA ODLUKA JER SAM SVE MOGAO ISPITATI U DEVELOPMENT MODE-U)

MOGU STARTOVATI PRODUCTION BUILD

PA ONDA MOGU RUNN-OVATI http-server U dist FOLDERU

- yarn prod

OCIGLEDNO JE DA PORED OSNOVNOG BUNDLE-A, IMAM JOS JEDAN DODATNI (CODE-SPLITTING)

- cd dist

- http-server -p 7200 -a localhost

AKO POSMATRAM Network TAB DEV TOOLS-A, **VIDECU, SADA DVA NETWORK REQUEST** (GOVORIM SAMO O JAVASCRIPT-U), KOJI SU SE DOGODILI, I TO JE ONAJ ZA GLAVNIM BUNDLE-OM, I ONAJ ZA CHUNK-OM

**DAKLE CHUNK SE LOAD-OVAO TOKOM IDLE TIME-A** (ZATO MOGU VIDETI U Network TABU DEV TOOLS-A, DA JE ON POSLEDNJI LOADED), **STO SE NE BI NORMALNO DESILO DA NISAM KORISTIO PREFETCH**

PROVERICU HTML U Elemnt TABU DEV TOOLS-A, TO RADIM DA PROVERIM DA LI POSTOJI DODADTNI **`<link>`** TAB U head SEKCIJI PAGE-A

**I ZAISTA U U head TAGU NALAZI SE, I OVAJ link TAG:**

```javascript
<link rel="prefetch" as="script" href="some-balh-lazy-load.js">
```

AKO SADA PRITISNE BUTTON, U Network TABU DEV TOOLSA CE BITI REGISTROVAN JOS JEDAN NETWORK REQUEST, I TO JE REQUEST ZA ISTIM CHUNK-OM

A VIDECU DA JE CHUNK SERVIRAN **(from disk cache)** (**OVO JE ZAVEDENO POD *Size* KOLONU**)

## NAKON BUILDING-A CODEA, JA SAM MOGAO OTVORITI MAIN BUNDLE I POGLEDATI DA LI UNUTRA IMA NESTO STO SE ODNOSI NA PREFETCHING

I ZAISTA KADA SAM OTVORIO TAJ BUNDLE, I URADIO Ctrl + F, I ONDA TRAZIO prefetch; VIDEO BI DA JE CODE VEZAN ZA prefetch ZAISTA INSERTED U MOJ BUNDLE, STO JE PRACENO HELPFUL KOMENTARIMA

ONO STO CU NACI U CODU JESTE NESTO STO SE ZOVE chunkPreloadMap, PA ZATIM chunkPreloadData I TAKO DALJE

## LARKIN KAZE DA prefetch TAKODJE RADI DOBRO U KOMBINACIJI SA SERVICE WORKER-OM

TAKO STO BIH NA PRIMER, RESURS, ODNOSNO CHUNK SAVE-OVAO U Cache (TO JE POSEBAN CACHE) (KOJEM IMAM PRISTUP U SCOPE-U SERVICE WORKER-A), PA ZATI NAKO NRELOAD-A, MOGAO BI SERVE-OVATI, POMENUTI CHUNK, UPRAVO IZ CACHE-A

I ONDA IMAM ZERO COST ON THE NETWORK

## DAKLE SADA MOGU POSMATRATI STVARI DA DODATNI NETWORK REQUEST-OVI, ON INITIAL DOWNLOAD NISU BAD, JER KORISTIM PREFETCHING

- PREFETCHING SE DOGADJA ON IDLE I NECE BLOKIRATI BRZINU DOWNLOAD-A MAIN BUNDLE-A

- POSTACE ODMAH DOSTUPAN JER JE LINKED U HEAD SEKCIJI

- AKO UPOTREBIM SERVICE WORKERE ZA CACHING MOGU GA SLEDECI PUT SERVIRATI IZ CACHE-A (ONOG DRUGOG CACHE-A, ZA KOJI PREDPOSTAVLJAM DA CIM GA KORISTE, ON JESTE BRZI)

DAKLE OVAKAV LOADING JE VEOMA BRZ I TREBAO BI OVO KORISTITI SA MOJIM PROGRESSIVE WEB APP-OVIMA, KAKO BI POSTIGAO NAJBOLJE BRZINE

COVEK KOJI RAD IZA GITLAB JE OVO PROBAO EVO GA NJEGOV [TWEET](https://twitter.com/mikegreiling/status/993895833933316097)