# KORISCENJE WEB WORKER-A

DAKLE:

>>>Once created, a worker can send messages to the JavaScript code that created it, by posting messages to an event handler specified by that code (and vice versa)

## KONSTRUKTORSKA FUNKCIJA KOJA KREIRA Worker INSTANCU, ODNOSNO WEB WORKER-A

REC JE O

- **Worker** KONSTRUKTORU

ARGUMENT: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**PATH DO JAVSCRIPT FAJLA**

SLEDECE CE MI POMOCI DA LAKSE FORMIRAM MENTAL PICTURE O THREAD-OVIMA:

**main.js** (FAJL, KOJEM JE GLOBALNI CONTEXT, window OBJEKAT)

```javascript
const webWorkerInstanca = new Worker('web_worker.js');

console.log(self);
console.log(webWorkerInstanca);
```

**web_worker.js**

```javascript
console.log(self);
```

OVO JE OUTPUT U KONZOLI:

```JAVASCRIPT
// --> Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, parent: Window, …}

// --> Worker {onmessage: null, onerror: null}

// --> DedicatedWorkerGlobalScope {name: "", onmessage: null, onmessageerror: null, postMessage: ƒ, close: ƒ, …}
```

MOGU SE, IZMEDJU OSTALOG UVERITI U ASINHRONOST WORKER THREADA

ODENOSNO, PREDPOSTAVLJAM DA JE PREDHODNO console.log POZIVANJE BILO QUEUED, DA BI SE IZVRSILO, NAKON ZAVRSETKA MAIN THREAD-A

A MOGU SE UVERITI DA I WORKER-OV THREAD, IMA PRISTUP KONZOLI BROWSER-A

## TREBA UVEK PROVERITI DA LI POSTOJI Worker KONSTRUKTOR, JER GA SIGURNO, NEKE STARIJE VERZIJE BROWSERA NE PODRZAVAJU

DAKLE U MAIN THREAD-U, TREBA DEFINISATI SLEDECE:

```javascript
if('Worker' in window){
    // SLUSANJE 'message' EVENTA
    // SLANJE PORUKA U WORKEROW THREAD
}else{
    // DEFINISEM ONO STO SE TREBA URADITI U CILJU BACKWARDS COMPATIBILITY-JA
    // OVIM MI JE TAKODJE ZAGARANTOVAN SLIGHTLY MORE CONTROLLED ERROR HANDLING
}
```

## SPAWNING DEDICATED WORKER-A

main.js FAJL:

```JAVASCRIPT
const myWorker = new Worker('web_worker.js');
```

## postMesage METODA, KOJA SE KORISTI ZA 'KOMUNIKACIJU', IZMEDJU WORKER THREAD-A I MAIN THREAD-A

KADA SALJEM DATA OD WORKER-OVOG THREADA, U MAIN THREAD-A:

- postMessage JESTE METODA self-A, ODNOSNO METODA DedicatedWorkerGlobalScope-A

service-worker.js FAJL:

```javascript
self.postMessage('podaci koje salje worker-ov thread');

// ILI

postMessage('podaci koje salje worker-ov thread'); // JER self MOGU IZOSTAVITI, KAO STO IZOSTAVLJAM I window, KAD SAM U MAIN THREAD-U
```

KADA SALJEM DATA OD MAIN THREAD-A, U WORKER-OV THREAD

- postMessage JESTE METODA Worker INSTANCE

main.js FAJL:

```javascript
workerInstanca.postMessage('podaci, koje salje main thread');
```

## DATA SE PRIHVATA, SLUSANJEM EVENTA TIPA 'message', (TJ SLUSA SE ZA TRIGGERING-OM MessageEvent INSTANCE)

DAKLE, KADA WORKER-OV THREAD PRIHVATA PORUKU, ON JE MORA PRIHVATITI U OBIMU **onmessage** HANDLER-A, KOJI JE HANDLER KOJI SE KACI NA self (DedicatedWorkerGlobalScope)

A KADA MAIN THREAD PRIHVATA PORUKU, ON JE MORA PRIHVATITI U OBIMU, TAKODJE **onmessage** HANDLER-A, KOJI JE U OVOM SLUCAJU HANDLER Worker INSTANCE

PODACI SE NALAZE U **data** PROPERTIJU MessageEvent INSTANCE

web-worker.js FAJL

```javascript
self.addEventListener('message', function(ev){
    console.log(ev.data);
});

// ILI

self.onmessage = function(ev){
    console.log(ev.data);
};

// ILI

onmessage = function(ev){
    console.log(ev.data);
};
```

main.js FAJL:

```javascript
workerInstanca.addEventListener('message', function(ev){
    console.log(ev.data);
});

// 

workerInstanca.onmessage = function(ev){
    console.log(ev.data);
};
```

## SLANJE VISE OD JEDNE PORUKE

